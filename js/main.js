"use strict";function grayAndGrain(t){for(var e=t.data,o=void 0,i=0;i<e.length;i+=4){o=Math.random()+1;var n=e[i],a=e[i+1],s=e[i+2],r=.2126*n+.7152*a+.0722*s;e[i]=e[i+1]=e[i+2]=r*o}return t}function drawBackground(t,e){t.fillStyle=e,t.fillRect(0,0,canvas.width,canvas.height)}function drawCenterPlayButton(t,e){t.fillStyle=""+e;var o={width:35,height:50};o.points={top:{x:(canvas.width-o.width)/2,y:(canvas.height-o.height)/2},bottom:{x:(canvas.width-o.width)/2,y:(canvas.height+o.height)/2},right:{x:(canvas.width+o.width)/2,y:canvas.height/2}},controlElements.push({type:"start",top:o.points.top.y,left:o.points.top.x,bottom:o.points.bottom.y,right:o.points.right.x}),t.beginPath(),t.moveTo(o.points.top.x,o.points.top.y),t.lineTo(o.points.bottom.x,o.points.bottom.y),t.lineTo(o.points.right.x,o.points.right.y),t.fill()}function drawControls(t,e){t.fillStyle=""+e;t.fillRect(80,canvas.height-controlTopPoint,controlRectWidth,controlRectHeight),t.fillRect(110,canvas.height-controlTopPoint,controlRectWidth,controlRectHeight)}function drawSkratches(){var t=Math.random()*(.8-.2);ctx.strokeStyle="rgba(255, 255, 255, "+t+")";var e=Math.floor(101*Math.random());if(e-=98,e>0)for(var o=0;o<e;o++)skratch()}function skratch(){ctx.beginPath();var t={x:Math.floor(Math.random()*(canvas.width-1)),y:Math.floor(Math.random()*(canvas.height-1))},e={x:t.x,y:Math.floor(Math.random()*(canvas.height-t.y))};ctx.moveTo(t.x,t.y),ctx.lineTo(e.x,e.y),ctx.stroke()}function startDrawLoop(){loopId||isSubtitleShown?"undefined"!=typeof subtitles[subtitleIndex]&&(subTimeout=setTimeout(hideSub,subtitles[subtitleIndex].timeLength/2)):loopId=setInterval(drawLoop,fps)}function stopDrawLoop(){loopId&&(clearInterval(loopId),loopId=void 0)}function drawLoop(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(video,0,0,video.width,video.height);var t=ctx.getImageData(0,0,canvas.width,canvas.height),e=grayAndGrain(t);ctx.putImageData(e,0,0),drawSkratches()}function _onInputChange(t){var e=new FileReader;switch(!0){case t.target.classList.contains("links-form__video"):e.readAsDataURL(t.target.files[0]),e.addEventListener("load",function(t){createVideo(e.result)});break;case t.target.classList.contains("links-form__sub"):e.readAsText(t.target.files[0]),e.addEventListener("load",function(t){subtitles=parseSrt(e.result)});break;case t.target.classList.contains("links-form__audio"):e.readAsDataURL(t.target.files[0]),e.addEventListener("load",function(t){createAudio(e.result)})}checkInputs()}function checkInputs(){var t=document.querySelectorAll(".links-form__input"),e=!0;t.forEach(function(t){""===t.value&&(e=!1)}),e&&(showPlayer(),initCanvas())}function createVideo(t){video=document.createElement("video"),video.src=t,video.defaultMuted=!0,video.classList.add("player__video"),video.width=700,video.height=400,document.querySelector(".hidden-elements").appendChild(video),video.addEventListener("play",startDrawLoop,!1),video.addEventListener("pause",stopDrawLoop,!1),video.addEventListener("timeupdate",function(t){var e=(1e3*t.target.currentTime).toFixed();"undefined"!=typeof subtitles[subtitleIndex]&&e>=subtitles[subtitleIndex].endTime&&(isSubtitleShown||showSub(subtitles[subtitleIndex]))}),video.addEventListener("ended",function(t){audio.stop(),stopDrawLoop()},!1)}function createAudio(t){audio=document.createElement("audio"),audio.src=t,audio.autoplay=!1,audio.classList.add("player__audio"),document.querySelector(".hidden-elements").appendChild(audio)}function showPlayer(){linksEl.classList.add("hidden"),playerEl.classList.remove("hidden")}function initCanvas(){canvas=document.querySelector(".player__canvas"),canvasStartState(),canvas.addEventListener("click",function(t){var e=t.pageX-t.target.offsetLeft,o=t.pageY-t.target.offsetTop;controlElements.some(function(t){e<t.right&&e>t.left&&o>t.top&&o<t.bottom&&("pause"==t.type?(isSubtitleShown?(stopSubTimeout(),audio.pause()):(video.pause(),audio.pause(),stopDrawLoop()),controlElements=[],createStartElement()):isSubtitleShown?(startSubTimeout(),audio.play()):(video.play(),audio.play(),createPauseElement()))})},!1)}function createStartElement(){controlElements=[{type:"start",top:0,left:0,right:canvas.width,bottom:canvas.width-20}]}function createPauseElement(){controlElements=[{type:"pause",top:0,left:0,right:canvas.width,bottom:canvas.width-20}]}function canvasStartState(){video.width=canvas.width=video.offsetWidth,video.height=canvas.height=video.offsetHeight;var t=canvas.getContext("2d");drawBackground(t,"black"),drawCenterPlayButton(t,"white")}function parseSrt(t){var e={sec:1e3,min:60,hr:60},o=t.split("\n\n"),i=o.map(function(t){var o={},i=t.split("\n");o.number=parseInt(i[0]);var n=i[1].split(" --> "),a=n[0].split(":"),s=parseInt(a[2].split(",").join("")),r=parseInt(a[1])*e.min*e.sec,c=parseInt(a[0])*e.hr*e.min*e.sec;a=s+r+c,o.startTime=a;var d=n[1].split(":"),l=parseInt(d[2].split(",").join("")),u=parseInt(d[1])*e.min*e.sec,h=parseInt(d[0])*e.hr*e.min*e.sec;return d=l+u+h,o.endTime=d,o.timeLength=d-a,i.splice(0,2),o.content=i,o});return i}function showSub(t){isSubtitleShown=!0,video.pause(),drawSub(t)}function drawSub(t){ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.font="1.5em Oranienbaum, serif";var e=24*t.content.length+12*(t.content.length-1),o=(canvas.height-e)/2;t.content.forEach(function(t,e){var i=o+24*e+12*e,n=.1*canvas.width;ctx.fillText(t,n,i)})}function hideSub(){isSubtitleShown&&(isSubtitleShown=!1,subtitleIndex++,video.play()),clearTimeout(subTimeout),subTimeout=void 0,controlElements=[],createPauseElement()}function stopSubTimeout(){subTimeout&&(clearTimeout(subTimeout),subTimeout=void 0)}function startSubTimeout(){subTimeout=setTimeout(hideSub,subtitles[subtitleIndex].timeLength)}var canvas=document.querySelector(".player__canvas"),ctx=canvas.getContext("2d"),controlBottomPoint=10,controlTopPoint=60,controlTrianglePoint=35,controlRectHeight=50,controlRectWidth=20,fps=1e3/60,loopId=void 0,linksForm=document.querySelector(".links-form"),linksEl=document.querySelector(".links"),playerEl=document.querySelector(".player"),isSubtitleShown=!1,subtitles=void 0,subTimeout=void 0;linksForm.addEventListener("change",_onInputChange,!1);var video=void 0,canvas=void 0,audio=void 0,controlBottomPoint=10,controlTopPoint=60,controlTrianglePoint=35,controlRectHeight=50,controlRectWidth=20,fps=1e3/60,videoWidth=void 0,videoHeight=void 0,videoSizeRatio=void 0,controlElements=[],reader=new FileReader,srt=void 0,subtitleIndex=0;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJkcmF3LmpzIiwiaW5wdXQuanMiLCJzdWJzLmpzIl0sIm5hbWVzIjpbImdyYXlBbmRHcmFpbiIsImltYWdlRGF0YSIsInBpeGVscyIsImRhdGEiLCJ2YWx1ZSIsImkiLCJsZW5ndGgiLCJNYXRoIiwicmFuZG9tIiwiciIsImciLCJiIiwidiIsImRyYXdCYWNrZ3JvdW5kIiwiY3R4IiwiY29sb3IiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImNhbnZhcyIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhd0NlbnRlclBsYXlCdXR0b24iLCJ0cmlhbmdsZSIsInBvaW50cyIsInRvcCIsIngiLCJ5IiwiYm90dG9tIiwicmlnaHQiLCJjb250cm9sRWxlbWVudHMiLCJwdXNoIiwidHlwZSIsImxlZnQiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJmaWxsIiwiZHJhd0NvbnRyb2xzIiwiY29udHJvbFRvcFBvaW50IiwiY29udHJvbFJlY3RXaWR0aCIsImNvbnRyb2xSZWN0SGVpZ2h0IiwiZHJhd1NrcmF0Y2hlcyIsInN0cm9rZU9wYWNpdHkiLCJzdHJva2VTdHlsZSIsImFtb3VudE9mU2tyYXRjaGVzIiwiZmxvb3IiLCJza3JhdGNoIiwic3RhcnRQb2ludCIsImVuZFBvaW50Iiwic3Ryb2tlIiwic3RhcnREcmF3TG9vcCIsImxvb3BJZCIsImlzU3VidGl0bGVTaG93biIsInN1YnRpdGxlcyIsInN1YnRpdGxlSW5kZXgiLCJzdWJUaW1lb3V0Iiwic2V0VGltZW91dCIsImhpZGVTdWIiLCJ0aW1lTGVuZ3RoIiwic2V0SW50ZXJ2YWwiLCJkcmF3TG9vcCIsImZwcyIsInN0b3BEcmF3TG9vcCIsImNsZWFySW50ZXJ2YWwiLCJ1bmRlZmluZWQiLCJjbGVhclJlY3QiLCJkcmF3SW1hZ2UiLCJ2aWRlbyIsImdldEltYWdlRGF0YSIsImltYWdlRGF0YUZpbHRlcmVkIiwicHV0SW1hZ2VEYXRhIiwiX29uSW5wdXRDaGFuZ2UiLCJlIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsInRhcmdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVhZEFzRGF0YVVSTCIsImZpbGVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNyZWF0ZVZpZGVvIiwicmVzdWx0IiwicmVhZEFzVGV4dCIsInBhcnNlU3J0IiwiY3JlYXRlQXVkaW8iLCJjaGVja0lucHV0cyIsImlucHV0cyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInZhbGlkYXRpb24iLCJmb3JFYWNoIiwiaW5wdXQiLCJzaG93UGxheWVyIiwiaW5pdENhbnZhcyIsInNyYyIsImNyZWF0ZUVsZW1lbnQiLCJkZWZhdWx0TXV0ZWQiLCJhZGQiLCJxdWVyeVNlbGVjdG9yIiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwiY3VycmVudFRpbWUiLCJ0b0ZpeGVkIiwiZW5kVGltZSIsInNob3dTdWIiLCJhdWRpbyIsInN0b3AiLCJhdXRvcGxheSIsImxpbmtzRWwiLCJwbGF5ZXJFbCIsInJlbW92ZSIsImNhbnZhc1N0YXJ0U3RhdGUiLCJjbGlja2VkWCIsInBhZ2VYIiwib2Zmc2V0TGVmdCIsImNsaWNrZWRZIiwicGFnZVkiLCJvZmZzZXRUb3AiLCJzb21lIiwiZWwiLCJzdG9wU3ViVGltZW91dCIsInBhdXNlIiwiY3JlYXRlU3RhcnRFbGVtZW50Iiwic3RhcnRTdWJUaW1lb3V0IiwicGxheSIsImNyZWF0ZVBhdXNlRWxlbWVudCIsIm9mZnNldFdpZHRoIiwib2Zmc2V0SGVpZ2h0IiwiZ2V0Q29udGV4dCIsInRleHQiLCJ0aW1lQ29uc3QiLCJzZWMiLCJtaW4iLCJociIsInRlbXAiLCJzcGxpdCIsIm1hcCIsInJlcyIsInN1YnRpdGxlIiwibnVtYmVyIiwicGFyc2VJbnQiLCJzdGFydFRpbWUiLCJzdGFydFRpbWVTZWMiLCJqb2luIiwic3RhcnRUaW1lTWluIiwic3RhcnRUaW1lSHIiLCJlbmRUaW1lU2VjIiwiZW5kVGltZU1pbiIsImVuZFRpbWVIciIsInNwbGljZSIsImNvbnRlbnQiLCJzdWIiLCJkcmF3U3ViIiwiZm9udCIsInRleHRIZWlnaHQiLCJ0b3BQYWRkaW5nIiwiZmlsbFRleHQiLCJjbGVhclRpbWVvdXQiLCJjb250cm9sQm90dG9tUG9pbnQiLCJjb250cm9sVHJpYW5nbGVQb2ludCIsImxpbmtzRm9ybSIsInZpZGVvV2lkdGgiLCJ2aWRlb0hlaWdodCIsInZpZGVvU2l6ZVJhdGlvIiwic3J0Il0sIm1hcHBpbmdzIjoiQUFBQSxZQ1dBLFNBQVNBLGNBQWNDLEdBTW5CLElBQUssR0FKREMsR0FBU0QsRUFBVUUsS0FDbkJDLEVBQUEsT0FHS0MsRUFBSSxFQUFHQSxFQUFJSCxFQUFPSSxPQUFRRCxHQUFLLEVBQUcsQ0FDdkNELEVBQVFHLEtBQUtDLFNBQVcsQ0FDeEIsSUFBSUMsR0FBSVAsRUFBT0csR0FDWEssRUFBSVIsRUFBT0csRUFBRSxHQUNiTSxFQUFJVCxFQUFPRyxFQUFFLEdBR2JPLEVBQUksTUFBT0gsRUFBSSxNQUFPQyxFQUFJLE1BQU9DLENBRXJDVCxHQUFPRyxHQUFLSCxFQUFPRyxFQUFFLEdBQUtILEVBQU9HLEVBQUUsR0FBS08sRUFBSVIsRUFHaEQsTUFBT0gsR0FHWCxRQUFTWSxnQkFBZ0JDLEVBQUtDLEdBQzFCRCxFQUFJRSxVQUFZRCxFQUNoQkQsRUFBSUcsU0FBUyxFQUFHLEVBQUdDLE9BQU9DLE1BQU9ELE9BQU9FLFFBRzVDLFFBQVNDLHNCQUFzQlAsRUFBS0MsR0FDaENELEVBQUlFLFVBQUosR0FBbUJELENBQ25CLElBQUlPLElBQ0FILE1BQU8sR0FDUEMsT0FBUSxHQUdaRSxHQUFTQyxRQUNMQyxLQUNJQyxHQUFJUCxPQUFPQyxNQUFRRyxFQUFTSCxPQUFTLEVBQ3JDTyxHQUFJUixPQUFPRSxPQUFTRSxFQUFTRixRQUFVLEdBRTNDTyxRQUNJRixHQUFJUCxPQUFPQyxNQUFRRyxFQUFTSCxPQUFTLEVBQ3JDTyxHQUFJUixPQUFPRSxPQUFTRSxFQUFTRixRQUFVLEdBRTNDUSxPQUNJSCxHQUFJUCxPQUFPQyxNQUFRRyxFQUFTSCxPQUFTLEVBQ3JDTyxFQUFHUixPQUFPRSxPQUFTLElBSTNCUyxn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T0doQkEvRyxjQUFnQiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHZpZGVvLCBjYW52YXMsIGF1ZGlvO1xuXG5jb25zdCBjb250cm9sQm90dG9tUG9pbnQgPSAxMDtcbmNvbnN0IGNvbnRyb2xUb3BQb2ludCA9IDYwO1xuY29uc3QgY29udHJvbFRyaWFuZ2xlUG9pbnQgPSAzNTtcbmNvbnN0IGNvbnRyb2xSZWN0SGVpZ2h0ID0gNTA7XG5jb25zdCBjb250cm9sUmVjdFdpZHRoID0gMjA7XG5jb25zdCBmcHMgPSAxMDAwIC8gNjA7XG5cbmxldCB2aWRlb1dpZHRoLFxuICAgIHZpZGVvSGVpZ2h0LFxuICAgIHZpZGVvU2l6ZVJhdGlvO1xuXG5sZXQgY29udHJvbEVsZW1lbnRzID0gW107XG5cbmxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xubGV0IHNydDtcblxuXG5mdW5jdGlvbiBzaG93UGxheWVyICgpIHtcbiAgICBsaW5rc0VsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgIHBsYXllckVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xufVxuXG5mdW5jdGlvbiBpbml0Q2FudmFzICgpIHtcbiAgICBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyX19jYW52YXMnKTtcbiAgICBjYW52YXNTdGFydFN0YXRlKCk7XG5cbiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBsZXQgY2xpY2tlZFggPSBlLnBhZ2VYIC0gZS50YXJnZXQub2Zmc2V0TGVmdDtcbiAgICAgICAgbGV0IGNsaWNrZWRZID0gZS5wYWdlWSAtIGUudGFyZ2V0Lm9mZnNldFRvcDtcbiAgICAgICAgY29udHJvbEVsZW1lbnRzLnNvbWUoKGVsKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2xpY2tlZFggPCBlbC5yaWdodCAmJiBjbGlja2VkWCA+IGVsLmxlZnQgJiYgY2xpY2tlZFkgPiBlbC50b3AgJiYgY2xpY2tlZFkgPCBlbC5ib3R0b20pIHtcbiAgICAgICAgICAgICAgICBpZihlbC50eXBlID09ICdwYXVzZScpe1xuICAgICAgICAgICAgICAgICAgICBpZighaXNTdWJ0aXRsZVNob3duKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdWRpby5wYXVzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcERyYXdMb29wKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9wU3ViVGltZW91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW8ucGF1c2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb250cm9sRWxlbWVudHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlU3RhcnRFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIWlzU3VidGl0bGVTaG93bikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW8ucGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlUGF1c2VFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFN1YlRpbWVvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSwgZmFsc2UpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTdGFydEVsZW1lbnQgKCkge1xuICAgIGNvbnRyb2xFbGVtZW50cyA9IFt7XG4gICAgICAgIHR5cGU6ICdzdGFydCcsXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgcmlnaHQ6IGNhbnZhcy53aWR0aCxcbiAgICAgICAgYm90dG9tOiBjYW52YXMud2lkdGggLSAyMFxuICAgIH1dO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVQYXVzZUVsZW1lbnQgKCkge1xuICAgIGNvbnRyb2xFbGVtZW50cyA9IFt7XG4gICAgICAgIHR5cGU6ICdwYXVzZScsXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgcmlnaHQ6IGNhbnZhcy53aWR0aCxcbiAgICAgICAgYm90dG9tOiBjYW52YXMud2lkdGggLSAyMFxuICAgIH1dO1xufVxuXG5mdW5jdGlvbiBjYW52YXNTdGFydFN0YXRlICgpIHtcbiAgICB2aWRlby53aWR0aCA9IGNhbnZhcy53aWR0aCA9IHZpZGVvLm9mZnNldFdpZHRoO1xuICAgIHZpZGVvLmhlaWdodCA9IGNhbnZhcy5oZWlnaHQgPSB2aWRlby5vZmZzZXRIZWlnaHQ7XG4gICAgbGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGRyYXdCYWNrZ3JvdW5kKGN0eCwgJ2JsYWNrJyk7XG4gICAgZHJhd0NlbnRlclBsYXlCdXR0b24oY3R4LCAnd2hpdGUnKTtcbn1cbiIsImNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXJfX2NhbnZhcycpO1xubGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG5jb25zdCBjb250cm9sQm90dG9tUG9pbnQgPSAxMDtcbmNvbnN0IGNvbnRyb2xUb3BQb2ludCA9IDYwO1xuY29uc3QgY29udHJvbFRyaWFuZ2xlUG9pbnQgPSAzNTtcbmNvbnN0IGNvbnRyb2xSZWN0SGVpZ2h0ID0gNTA7XG5jb25zdCBjb250cm9sUmVjdFdpZHRoID0gMjA7XG5jb25zdCBmcHMgPSAxMDAwIC8gNjA7XG5sZXQgbG9vcElkO1xuXG5mdW5jdGlvbiBncmF5QW5kR3JhaW4gKGltYWdlRGF0YSkge1xuICAgIC8vINC/0L7Qu9GD0YfQsNC10Lwg0L7QtNC90L7QvNC10YDQvdGL0Lkg0LzQsNGB0YHQuNCyLCDQvtC/0LjRgdGL0LLQsNGO0YnQuNC5INCy0YHQtSDQv9C40LrRgdC10LvQuCDQuNC30L7QsdGA0LDQttC10L3QuNGPXG4gICAgbGV0IHBpeGVscyA9IGltYWdlRGF0YS5kYXRhO1xuICAgIGxldCB2YWx1ZTtcblxuICAgIC8vINGG0LjQutC70LjRh9C10YHQutC4INC/0YDQtdC+0LHRgNCw0LfRg9C10Lwg0LzQsNGB0YHQuNCyLCDQuNC30LzQtdC90Y/RjyDQt9C90LDRh9C10L3QuNGPINC60YDQsNGB0L3QvtCz0L4sINC30LXQu9C10L3QvtCz0L4g0Lgg0YHQuNC90LXQs9C+INC60LDQvdCw0LvQvtCyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwaXhlbHMubGVuZ3RoOyBpICs9IDQpIHtcbiAgICAgICAgdmFsdWUgPSBNYXRoLnJhbmRvbSgpICsgMTtcbiAgICAgICAgbGV0IHIgPSBwaXhlbHNbaV07XG4gICAgICAgIGxldCBnID0gcGl4ZWxzW2krMV07XG4gICAgICAgIGxldCBiID0gcGl4ZWxzW2krMl07XG4gICAgICAgIC8vIENJRSBsdW1pbmFuY2UgZm9yIHRoZSBSR0JcbiAgICAgICAgLy8gVGhlIGh1bWFuIGV5ZSBpcyBiYWQgYXQgc2VlaW5nIHJlZCBhbmQgYmx1ZSwgc28gd2UgZGUtZW1waGFzaXplIHRoZW0uXG4gICAgICAgIGxldCB2ID0gMC4yMTI2KnIgKyAwLjcxNTIqZyArIDAuMDcyMipiO1xuXG4gICAgICAgIHBpeGVsc1tpXSA9IHBpeGVsc1tpKzFdID0gcGl4ZWxzW2krMl0gPSB2ICogdmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGltYWdlRGF0YTtcbn07XG5cbmZ1bmN0aW9uIGRyYXdCYWNrZ3JvdW5kIChjdHgsIGNvbG9yKSB7XG4gICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xufVxuXG5mdW5jdGlvbiBkcmF3Q2VudGVyUGxheUJ1dHRvbiAoY3R4LCBjb2xvcikge1xuICAgIGN0eC5maWxsU3R5bGUgPSBgJHtjb2xvcn1gO1xuICAgIGxldCB0cmlhbmdsZSA9IHtcbiAgICAgICAgd2lkdGg6IDM1LFxuICAgICAgICBoZWlnaHQ6IDUwXG4gICAgfTtcblxuICAgIHRyaWFuZ2xlLnBvaW50cyA9IHtcbiAgICAgICAgdG9wOiB7XG4gICAgICAgICAgICB4OiAoY2FudmFzLndpZHRoIC0gdHJpYW5nbGUud2lkdGgpIC8gMixcbiAgICAgICAgICAgIHk6IChjYW52YXMuaGVpZ2h0IC0gdHJpYW5nbGUuaGVpZ2h0KSAvIDJcbiAgICAgICAgfSxcbiAgICAgICAgYm90dG9tOiB7XG4gICAgICAgICAgICB4OiAoY2FudmFzLndpZHRoIC0gdHJpYW5nbGUud2lkdGgpIC8gMixcbiAgICAgICAgICAgIHk6IChjYW52YXMuaGVpZ2h0ICsgdHJpYW5nbGUuaGVpZ2h0KSAvIDJcbiAgICAgICAgfSxcbiAgICAgICAgcmlnaHQ6IHtcbiAgICAgICAgICAgIHg6IChjYW52YXMud2lkdGggKyB0cmlhbmdsZS53aWR0aCkgLyAyLFxuICAgICAgICAgICAgeTogY2FudmFzLmhlaWdodCAvIDJcbiAgICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29udHJvbEVsZW1lbnRzLnB1c2goe1xuICAgICAgICB0eXBlOiAnc3RhcnQnLFxuICAgICAgICB0b3A6IHRyaWFuZ2xlLnBvaW50cy50b3AueSxcbiAgICAgICAgbGVmdDogdHJpYW5nbGUucG9pbnRzLnRvcC54LFxuICAgICAgICBib3R0b206IHRyaWFuZ2xlLnBvaW50cy5ib3R0b20ueSxcbiAgICAgICAgcmlnaHQ6IHRyaWFuZ2xlLnBvaW50cy5yaWdodC54XG4gICAgfSk7XG5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyh0cmlhbmdsZS5wb2ludHMudG9wLngsIHRyaWFuZ2xlLnBvaW50cy50b3AueSk7XG4gICAgY3R4LmxpbmVUbyh0cmlhbmdsZS5wb2ludHMuYm90dG9tLngsIHRyaWFuZ2xlLnBvaW50cy5ib3R0b20ueSk7XG4gICAgY3R4LmxpbmVUbyh0cmlhbmdsZS5wb2ludHMucmlnaHQueCwgdHJpYW5nbGUucG9pbnRzLnJpZ2h0LnkpO1xuICAgIGN0eC5maWxsKCk7XG59XG5cbmZ1bmN0aW9uIGRyYXdDb250cm9scyAoY3R4LCBjb2xvcikge1xuICAgIGN0eC5maWxsU3R5bGUgPSBgJHtjb2xvcn1gO1xuXG4gICAgbGV0IHRyaWFuZ2xlID0ge1xuICAgIH1cbiAgICBjdHguZmlsbFJlY3QoODAsIGNhbnZhcy5oZWlnaHQgLSBjb250cm9sVG9wUG9pbnQsIGNvbnRyb2xSZWN0V2lkdGgsIGNvbnRyb2xSZWN0SGVpZ2h0KTtcbiAgICBjdHguZmlsbFJlY3QoMTEwLCBjYW52YXMuaGVpZ2h0IC0gY29udHJvbFRvcFBvaW50LCBjb250cm9sUmVjdFdpZHRoLCBjb250cm9sUmVjdEhlaWdodCk7XG59XG5cbmZ1bmN0aW9uIGRyYXdTa3JhdGNoZXMgKCkge1xuICAgIGxldCBzdHJva2VPcGFjaXR5ID0gTWF0aC5yYW5kb20oKSAqICgwLjggLSAwLjIpO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IGByZ2JhKDI1NSwgMjU1LCAyNTUsICR7c3Ryb2tlT3BhY2l0eX0pYDtcblxuICAgIGxldCBhbW91bnRPZlNrcmF0Y2hlcyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAwICsgMSkpO1xuICAgIGFtb3VudE9mU2tyYXRjaGVzIC09IDk4O1xuICAgIGlmKGFtb3VudE9mU2tyYXRjaGVzID4gMCl7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBhbW91bnRPZlNrcmF0Y2hlczsgaSsrKXtcbiAgICAgICAgICAgIHNrcmF0Y2goKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gc2tyYXRjaCAoKSB7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGxldCBzdGFydFBvaW50ID0ge1xuICAgICAgICB4OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoY2FudmFzLndpZHRoIC0gMSkpLFxuICAgICAgICB5OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoY2FudmFzLmhlaWdodCAtIDEpKVxuICAgIH07XG5cbiAgICBsZXQgZW5kUG9pbnQgPSB7XG4gICAgICAgIHg6IHN0YXJ0UG9pbnQueCxcbiAgICAgICAgeTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGNhbnZhcy5oZWlnaHQgLSBzdGFydFBvaW50LnkpKVxuICAgIH07XG5cbiAgICBjdHgubW92ZVRvKHN0YXJ0UG9pbnQueCwgc3RhcnRQb2ludC55KTtcbiAgICBjdHgubGluZVRvKGVuZFBvaW50LngsIGVuZFBvaW50LnkpO1xuICAgIGN0eC5zdHJva2UoKTtcbn1cblxuZnVuY3Rpb24gc3RhcnREcmF3TG9vcCAoKSB7XG4gICAgaWYoIWxvb3BJZCAmJiAhaXNTdWJ0aXRsZVNob3duKXtcbiAgICAgICAgbG9vcElkID0gc2V0SW50ZXJ2YWwoZHJhd0xvb3AsIGZwcyk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc3VidGl0bGVzW3N1YnRpdGxlSW5kZXhdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBzdWJUaW1lb3V0ID0gc2V0VGltZW91dChoaWRlU3ViLCBzdWJ0aXRsZXNbc3VidGl0bGVJbmRleF0udGltZUxlbmd0aCAvIDIpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc3RvcERyYXdMb29wICgpIHtcbiAgICBpZihsb29wSWQpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChsb29wSWQpO1xuICAgICAgICBsb29wSWQgPSB1bmRlZmluZWQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkcmF3TG9vcCAoKSB7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGN0eC5kcmF3SW1hZ2UodmlkZW8sIDAsIDAsIHZpZGVvLndpZHRoLCB2aWRlby5oZWlnaHQpO1xuICAgIFxuICAgIGxldCBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgbGV0IGltYWdlRGF0YUZpbHRlcmVkID0gZ3JheUFuZEdyYWluKGltYWdlRGF0YSk7XG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGFGaWx0ZXJlZCwgMCwgMCk7XG5cbiAgICBkcmF3U2tyYXRjaGVzKCk7XG59XG4iLCJjb25zdCBsaW5rc0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubGlua3MtZm9ybScpO1xuY29uc3QgbGlua3NFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saW5rcycpO1xuY29uc3QgcGxheWVyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyJyk7XG5cbmxldCBpc1N1YnRpdGxlU2hvd24gPSBmYWxzZTtcbmxldCBzdWJ0aXRsZXM7XG5sZXQgc3ViVGltZW91dDtcblxubGlua3NGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIF9vbklucHV0Q2hhbmdlLCBmYWxzZSk7XG5cbmZ1bmN0aW9uIF9vbklucHV0Q2hhbmdlIChlKSB7XG4gICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICBjYXNlIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbGlua3MtZm9ybV9fdmlkZW8nKTpcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZS50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICByZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIChlKSA9PiB7XG4gICAgICAgICAgICBjcmVhdGVWaWRlbyhyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgIGNhc2UgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdsaW5rcy1mb3JtX19zdWInKTpcbiAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZS50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICByZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIChlKSA9PiB7XG4gICAgICAgICAgICBzdWJ0aXRsZXMgPSBwYXJzZVNydChyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgIGNhc2UgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdsaW5rcy1mb3JtX19hdWRpbycpOlxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChlLnRhcmdldC5maWxlc1swXSk7XG4gICAgICAgIHJlYWRlci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKGUpID0+IHtcbiAgICAgICAgICAgIGNyZWF0ZUF1ZGlvKHJlYWRlci5yZXN1bHQpO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgY2hlY2tJbnB1dHMoKTtcbn1cblxuZnVuY3Rpb24gY2hlY2tJbnB1dHMgKCkge1xuICAgIGxldCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubGlua3MtZm9ybV9faW5wdXQnKTtcbiAgICBsZXQgdmFsaWRhdGlvbiA9IHRydWU7XG5cbiAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgaWYoaW5wdXQudmFsdWUgPT09ICcnKXtcbiAgICAgICAgICAgIHZhbGlkYXRpb24gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYodmFsaWRhdGlvbikge1xuICAgICAgICBzaG93UGxheWVyKCk7XG4gICAgICAgIGluaXRDYW52YXMoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVZpZGVvIChzcmMpIHtcbiAgICB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7XG4gICAgdmlkZW8uc3JjID0gc3JjO1xuICAgIHZpZGVvLmRlZmF1bHRNdXRlZCA9IHRydWU7XG4gICAgdmlkZW8uY2xhc3NMaXN0LmFkZCgncGxheWVyX192aWRlbycpO1xuICAgIHZpZGVvLndpZHRoID0gNzAwO1xuICAgIHZpZGVvLmhlaWdodCA9IDQwMDtcbiAgICBcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGlkZGVuLWVsZW1lbnRzJykuYXBwZW5kQ2hpbGQodmlkZW8pO1xuXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigncGxheScsIHN0YXJ0RHJhd0xvb3AsIGZhbHNlKTtcblxuICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3BhdXNlJywgc3RvcERyYXdMb29wLCBmYWxzZSk7XG5cbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCd0aW1ldXBkYXRlJywgKGUpID0+IHtcbiAgICAgICAgbGV0IHRpbWUgPSAoZS50YXJnZXQuY3VycmVudFRpbWUgKiAxMDAwKS50b0ZpeGVkKCk7XG4gICAgICAgIGlmICh0eXBlb2Ygc3VidGl0bGVzW3N1YnRpdGxlSW5kZXhdICE9PSAndW5kZWZpbmVkJyAmJiB0aW1lID49IHN1YnRpdGxlc1tzdWJ0aXRsZUluZGV4XS5lbmRUaW1lKSB7XG4gICAgICAgICAgICBpZiAoIWlzU3VidGl0bGVTaG93bikge1xuICAgICAgICAgICAgICAgIHNob3dTdWIoc3VidGl0bGVzW3N1YnRpdGxlSW5kZXhdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCAoZSkgPT4ge1xuICAgICAgICBhdWRpby5zdG9wKCk7XG4gICAgICAgIHN0b3BEcmF3TG9vcCgpO1xuICAgIH0sIGZhbHNlKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQXVkaW8gKHNyYykge1xuICAgIGF1ZGlvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYXVkaW8nKTtcblx0YXVkaW8uc3JjID0gc3JjO1xuXHRhdWRpby5hdXRvcGxheSA9IGZhbHNlO1xuICAgIGF1ZGlvLmNsYXNzTGlzdC5hZGQoJ3BsYXllcl9fYXVkaW8nKTtcblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oaWRkZW4tZWxlbWVudHMnKS5hcHBlbmRDaGlsZChhdWRpbyk7XG59XG4iLCJsZXQgc3VidGl0bGVJbmRleCA9IDA7XG5cbmZ1bmN0aW9uIHBhcnNlU3J0ICh0ZXh0KSB7XG4gICAgbGV0IHRpbWVDb25zdCA9IHtcbiAgICAgICAgc2VjOiAxMDAwLFxuICAgICAgICBtaW46IDYwLFxuICAgICAgICBocjogNjBcbiAgICB9O1xuICAgIGxldCB0ZW1wID0gdGV4dC5zcGxpdCgnXFxuXFxuJyk7XG5cbiAgICBsZXQgcmVzdWx0ID0gdGVtcC5tYXAoKGVsKSA9PiB7XG5cbiAgICAgICAgbGV0IHJlcyA9IHt9O1xuICAgICAgICBsZXQgc3VidGl0bGUgPSBlbC5zcGxpdCgnXFxuJyk7XG5cbiAgICAgICAgLy8gPT09IEdldCBzdWJ0aXRsZSdzIG51bWJlciA9PT1cbiAgICAgICAgcmVzLm51bWJlciA9IHBhcnNlSW50KHN1YnRpdGxlWzBdKTtcblxuICAgICAgICBsZXQgdGltZSA9IHN1YnRpdGxlWzFdLnNwbGl0KCcgLS0+ICcpO1xuXG4gICAgICAgIC8vID09PSBDb252ZXJ0IHN0YXJ0IHRpbWUgdG8gTVMgPT09XG4gICAgICAgIGxldCBzdGFydFRpbWUgPSB0aW1lWzBdLnNwbGl0KCc6Jyk7XG4gICAgICAgIGxldCBzdGFydFRpbWVTZWMgPSBwYXJzZUludChzdGFydFRpbWVbMl0uc3BsaXQoJywnKS5qb2luKCcnKSk7XG4gICAgICAgIGxldCBzdGFydFRpbWVNaW4gPSBwYXJzZUludChzdGFydFRpbWVbMV0pICogdGltZUNvbnN0Lm1pbiAqIHRpbWVDb25zdC5zZWM7XG4gICAgICAgIGxldCBzdGFydFRpbWVIciA9IHBhcnNlSW50KHN0YXJ0VGltZVswXSkgKiB0aW1lQ29uc3QuaHIgKiB0aW1lQ29uc3QubWluICogdGltZUNvbnN0LnNlYztcbiAgICAgICAgc3RhcnRUaW1lID0gc3RhcnRUaW1lU2VjICsgc3RhcnRUaW1lTWluXHQrIHN0YXJ0VGltZUhyO1xuICAgICAgICByZXMuc3RhcnRUaW1lID0gc3RhcnRUaW1lO1xuXG4gICAgICAgIC8vID09PSBDb252ZXJ0IGVuZCB0aW1lIHRvIE1TID09PVxuICAgICAgICBsZXQgZW5kVGltZSA9IHRpbWVbMV0uc3BsaXQoJzonKTtcbiAgICAgICAgbGV0IGVuZFRpbWVTZWMgPSBwYXJzZUludChlbmRUaW1lWzJdLnNwbGl0KCcsJykuam9pbignJykpO1xuICAgICAgICBsZXQgZW5kVGltZU1pbiA9IHBhcnNlSW50KGVuZFRpbWVbMV0pICogdGltZUNvbnN0Lm1pbiAqIHRpbWVDb25zdC5zZWM7XG4gICAgICAgIGxldCBlbmRUaW1lSHIgPSBwYXJzZUludChlbmRUaW1lWzBdKSAqIHRpbWVDb25zdC5ociAqIHRpbWVDb25zdC5taW4gKiB0aW1lQ29uc3Quc2VjO1xuICAgICAgICBlbmRUaW1lID0gZW5kVGltZVNlYyArIGVuZFRpbWVNaW5cdCsgZW5kVGltZUhyO1xuICAgICAgICByZXMuZW5kVGltZSA9IGVuZFRpbWU7XG5cbiAgICAgICAgcmVzLnRpbWVMZW5ndGggPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuXG4gICAgICAgIC8vID09PSBKb2luIHN1YnRpdGxlIGNvbnRlbnQgPT09XG4gICAgICAgIHN1YnRpdGxlLnNwbGljZSgwLCAyKTtcbiAgICAgICAgcmVzLmNvbnRlbnQgPSBzdWJ0aXRsZTtcblxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gc2hvd1N1YiAoc3ViKSB7XG4gICAgaXNTdWJ0aXRsZVNob3duID0gdHJ1ZTtcblxuICAgIHZpZGVvLnBhdXNlKCk7XG4gICAgZHJhd1N1YihzdWIpO1xufVxuXG5mdW5jdGlvbiBkcmF3U3ViIChzdWIpIHtcbiAgICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJztcbiAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICBjdHguZmlsbFN0eWxlID0gJ3doaXRlJztcbiAgICBjdHguZm9udCA9IGAxLjVlbSBPcmFuaWVuYmF1bSwgc2VyaWZgO1xuXG4gICAgbGV0IHRleHRIZWlnaHQgPSAoc3ViLmNvbnRlbnQubGVuZ3RoICogMjQpICsgKChzdWIuY29udGVudC5sZW5ndGggLSAxKSAqIDEyKTtcbiAgICBsZXQgdG9wUGFkZGluZyA9IChjYW52YXMuaGVpZ2h0IC0gdGV4dEhlaWdodCkgLyAyO1xuXG4gICAgc3ViLmNvbnRlbnQuZm9yRWFjaCgoZWwsIGkpID0+IHtcbiAgICAgICAgbGV0IHRvcCA9IHRvcFBhZGRpbmcgKyAoMjQgKiBpKSArICgxMiAqIGkpO1xuICAgICAgICBsZXQgbGVmdCA9IChjYW52YXMud2lkdGggKiAwLjEpO1xuICAgICAgICBjdHguZmlsbFRleHQoZWwsIGxlZnQsIHRvcCk7XG4gICAgfSk7IFxufVxuXG5mdW5jdGlvbiBoaWRlU3ViICgpIHtcbiAgICBpZiAoaXNTdWJ0aXRsZVNob3duKSB7XG4gICAgICAgIGlzU3VidGl0bGVTaG93biA9IGZhbHNlO1xuICAgICAgICBzdWJ0aXRsZUluZGV4Kys7XG4gICAgICAgIHZpZGVvLnBsYXkoKTtcbiAgICB9XG4gICAgY2xlYXJUaW1lb3V0KHN1YlRpbWVvdXQpO1xuICAgIHN1YlRpbWVvdXQgPSB1bmRlZmluZWQ7XG4gICAgY29udHJvbEVsZW1lbnRzID0gW107XG4gICAgY3JlYXRlUGF1c2VFbGVtZW50KCk7XG59XG5cbmZ1bmN0aW9uIHN0b3BTdWJUaW1lb3V0ICgpIHtcbiAgICBpZihzdWJUaW1lb3V0KSB7XG4gICAgICAgIGNsZWFyVGltZW91dChzdWJUaW1lb3V0KTtcbiAgICAgICAgc3ViVGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHN0YXJ0U3ViVGltZW91dCAoKSB7XG4gICAgc3ViVGltZW91dCA9IHNldFRpbWVvdXQoaGlkZVN1Yiwgc3VidGl0bGVzW3N1YnRpdGxlSW5kZXhdLnRpbWVMZW5ndGgpO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
