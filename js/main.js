"use strict";function createStartElement(){controlElements=[{type:"start",top:0,left:0,right:canvas.width,bottom:canvas.width-20}]}function createPauseElement(){controlElements=[{type:"pause",top:0,left:0,right:canvas.width,bottom:canvas.width-20}]}function canvasStartState(){video.width=canvas.width=video.offsetWidth,video.height=canvas.height=video.offsetHeight;var t=canvas.getContext("2d");drawBackground(t,"black"),drawCenterPlayButton(t,"white")}function grayAndGrain(t){for(var o=t.data,a=void 0,e=0;e<o.length;e+=4){a=Math.random()+1;var n=o[e],i=o[e+1],r=o[e+2],c=.2126*n+.7152*i+.0722*r;o[e]=o[e+1]=o[e+2]=c*a}return t}function drawBackground(t,o){t.fillStyle=o,t.fillRect(0,0,canvas.width,canvas.height)}function drawCenterPlayButton(t,o){t.fillStyle=""+o;var a={width:35,height:50};a.points={top:{x:(canvas.width-a.width)/2,y:(canvas.height-a.height)/2},bottom:{x:(canvas.width-a.width)/2,y:(canvas.height+a.height)/2},right:{x:(canvas.width+a.width)/2,y:canvas.height/2}},controlElements.push({type:"start",top:a.points.top.y,left:a.points.top.x,bottom:a.points.bottom.y,right:a.points.right.x}),t.beginPath(),t.moveTo(a.points.top.x,a.points.top.y),t.lineTo(a.points.bottom.x,a.points.bottom.y),t.lineTo(a.points.right.x,a.points.right.y),t.fill()}function drawControls(t,o){t.fillStyle=""+o;t.fillRect(80,canvas.height-controlTopPoint,controlRectWidth,controlRectHeight),t.fillRect(110,canvas.height-controlTopPoint,controlRectWidth,controlRectHeight)}function drawSkratches(t){var o=Math.random()*(.8-.2);t.strokeStyle="rgba(255, 255, 255, "+o+")";var a=Math.floor(101*Math.random());if(a-=98,a>0)for(var e=0;e<a;e++)skratch(t)}function skratch(t){t.beginPath();var o={x:Math.floor(Math.random()*(canvas.width-1)),y:Math.floor(Math.random()*(canvas.height-1))},a={x:o.x,y:Math.floor(Math.random()*(canvas.height-o.y))};t.moveTo(o.x,o.y),t.lineTo(a.x,a.y),t.stroke()}function startDrawLoop(){console.log("start draw"),loopId||(loopId=setInterval(drawLoop,fps))}function stopDrawLoop(){console.log("stop draw"),loopId&&(clearInterval(loopId),loopId=void 0)}function drawLoop(){var t=canvas.getContext("2d");t.clearRect(0,0,canvas.width,canvas.height),console.log("draw"),t.drawImage(video,0,0,video.width,video.height);var o=t.getImageData(0,0,canvas.width,canvas.height),a=grayAndGrain(o);t.putImageData(a,0,0),drawSkratches(t)}function parseSrt(t){var o={sec:1e3,min:60,hr:60},a=t.split("\n\n"),e=a.map(function(t){var a={},e=t.split("\n");a.number=parseInt(e[0]);var n=e[1].split(" --> "),i=n[0].split(":"),r=parseInt(i[2].split(",").join("")),c=parseInt(i[1])*o.min*o.sec,s=parseInt(i[0])*o.hr*o.min*o.sec;i=r+c+s,a.startTime=i;var l=n[1].split(":"),h=parseInt(l[2].split(",").join("")),d=parseInt(l[1])*o.min*o.sec,p=parseInt(l[0])*o.hr*o.min*o.sec;return l=h+d+p,a.endTime=l,a.timeLength=l-i,e.splice(0,2),a.content=e,a});return e}var video=document.querySelector(".player__video"),canvas=document.querySelector(".player__canvas"),audio=document.querySelector(".player__audio"),controlBottomPoint=10,controlTopPoint=60,controlTrianglePoint=35,controlRectHeight=50,controlRectWidth=20,fps=1e3/60,controlElements=[];document.addEventListener("DOMContentLoaded",function(){canvasStartState(),canvas.addEventListener("click",function(t){var o=t.pageX-t.target.offsetLeft,a=t.pageY-t.target.offsetTop;controlElements.some(function(t){o<t.right&&o>t.left&&a>t.top&&a<t.bottom&&("pause"==t.type?(video.pause(),audio.pause(),stopDrawLoop(),controlElements=[],createStartElement()):(video.play(),audio.play(),createPauseElement()))})})},!1),video.addEventListener("play",function(){startDrawLoop()},!1);var loopId=void 0;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiY3JlYXRlU3RhcnRFbGVtZW50IiwiY29udHJvbEVsZW1lbnRzIiwidHlwZSIsInRvcCIsImxlZnQiLCJyaWdodCIsImNhbnZhcyIsIndpZHRoIiwiYm90dG9tIiwiY3JlYXRlUGF1c2VFbGVtZW50IiwiY2FudmFzU3RhcnRTdGF0ZSIsInZpZGVvIiwib2Zmc2V0V2lkdGgiLCJoZWlnaHQiLCJvZmZzZXRIZWlnaHQiLCJjdHgiLCJnZXRDb250ZXh0IiwiZHJhd0JhY2tncm91bmQiLCJkcmF3Q2VudGVyUGxheUJ1dHRvbiIsImdyYXlBbmRHcmFpbiIsImltYWdlRGF0YSIsInBpeGVscyIsImRhdGEiLCJ2YWx1ZSIsImkiLCJsZW5ndGgiLCJNYXRoIiwicmFuZG9tIiwiciIsImciLCJiIiwidiIsImNvbG9yIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJ0cmlhbmdsZSIsInBvaW50cyIsIngiLCJ5IiwicHVzaCIsImJlZ2luUGF0aCIsIm1vdmVUbyIsImxpbmVUbyIsImZpbGwiLCJkcmF3Q29udHJvbHMiLCJjb250cm9sVG9wUG9pbnQiLCJjb250cm9sUmVjdFdpZHRoIiwiY29udHJvbFJlY3RIZWlnaHQiLCJkcmF3U2tyYXRjaGVzIiwic3Ryb2tlT3BhY2l0eSIsInN0cm9rZVN0eWxlIiwiYW1vdW50T2ZTa3JhdGNoZXMiLCJmbG9vciIsInNrcmF0Y2giLCJzdGFydFBvaW50IiwiZW5kUG9pbnQiLCJzdHJva2UiLCJzdGFydERyYXdMb29wIiwiY29uc29sZSIsImxvZyIsImxvb3BJZCIsInNldEludGVydmFsIiwiZHJhd0xvb3AiLCJmcHMiLCJzdG9wRHJhd0xvb3AiLCJjbGVhckludGVydmFsIiwidW5kZWZpbmVkIiwiY2xlYXJSZWN0IiwiZHJhd0ltYWdlIiwiZ2V0SW1hZ2VEYXRhIiwiaW1hZ2VEYXRhRmlsdGVyZWQiLCJwdXRJbWFnZURhdGEiLCJwYXJzZVNydCIsInRleHQiLCJ0aW1lQ29uc3QiLCJzZWMiLCJtaW4iLCJociIsInRlbXAiLCJzcGxpdCIsInJlc3VsdCIsIm1hcCIsImVsIiwicmVzIiwic3VidGl0bGUiLCJudW1iZXIiLCJwYXJzZUludCIsInRpbWUiLCJzdGFydFRpbWUiLCJzdGFydFRpbWVTZWMiLCJqb2luIiwic3RhcnRUaW1lTWluIiwic3RhcnRUaW1lSHIiLCJlbmRUaW1lIiwiZW5kVGltZVNlYyIsImVuZFRpbWVNaW4iLCJlbmRUaW1lSHIiLCJ0aW1lTGVuZ3RoIiwic3BsaWNlIiwiY29udGVudCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImF1ZGlvIiwiY29udHJvbEJvdHRvbVBvaW50IiwiY29udHJvbFRyaWFuZ2xlUG9pbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImNsaWNrZWRYIiwicGFnZVgiLCJ0YXJnZXQiLCJvZmZzZXRMZWZ0IiwiY2xpY2tlZFkiLCJwYWdlWSIsIm9mZnNldFRvcCIsInNvbWUiLCJwYXVzZSIsInBsYXkiXSwibWFwcGluZ3MiOiJBQUFBLFlBb0NBLFNBQVNBLHNCQUNMQyxrQkFDSUMsS0FBTSxRQUNOQyxJQUFLLEVBQ0xDLEtBQU0sRUFDTkMsTUFBT0MsT0FBT0MsTUFDZEMsT0FBUUYsT0FBT0MsTUFBUSxLQUkvQixRQUFTRSxzQkFDTFIsa0JBQ0lDLEtBQU0sUUFDTkMsSUFBSyxFQUNMQyxLQUFNLEVBQ05DLE1BQU9DLE9BQU9DLE1BQ2RDLE9BQVFGLE9BQU9DLE1BQVEsS0FJL0IsUUFBU0csb0JBQ0xDLE1BQU1KLE1BQVFELE9BQU9DLE1BQVFJLE1BQU1DLFlBQ25DRCxNQUFNRSxPQUFTUCxPQUFPTyxPQUFTRixNQUFNRyxZQUNyQyxJQUFJQyxHQUFNVCxPQUFPVSxXQUFXLEtBQzVCQyxnQkFBZUYsRUFBSyxTQUNwQkcscUJBQXFCSCxFQUFLLFNBRzlCLFFBQVNJLGNBQWNDLEdBTW5CLElBQUssR0FKREMsR0FBU0QsRUFBVUUsS0FDbkJDLEVBQUEsT0FHS0MsRUFBSSxFQUFHQSxFQUFJSCxFQUFPSSxPQUFRRCxHQUFLLEVBQUcsQ0FDdkNELEVBQVFH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ZXJ5U2VsZWN0b3IoJy5wbGF5ZXJfX3ZpZGVvJyk7XG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyX19jYW52YXMnKTtcbmNvbnN0IGF1ZGlvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcl9fYXVkaW8nKTtcblxuY29uc3QgY29udHJvbEJvdHRvbVBvaW50ID0gMTA7XG5jb25zdCBjb250cm9sVG9wUG9pbnQgPSA2MDtcbmNvbnN0IGNvbnRyb2xUcmlhbmdsZVBvaW50ID0gMzU7XG5jb25zdCBjb250cm9sUmVjdEhlaWdodCA9IDUwO1xuY29uc3QgY29udHJvbFJlY3RXaWR0aCA9IDIwO1xuY29uc3QgZnBzID0gMTAwMCAvIDYwO1xuXG5sZXQgY29udHJvbEVsZW1lbnRzID0gW107XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XG4gICAgY2FudmFzU3RhcnRTdGF0ZSgpO1xuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGxldCBjbGlja2VkWCA9IGUucGFnZVggLSBlLnRhcmdldC5vZmZzZXRMZWZ0O1xuICAgICAgICBsZXQgY2xpY2tlZFkgPSBlLnBhZ2VZIC0gZS50YXJnZXQub2Zmc2V0VG9wO1xuICAgICAgICBjb250cm9sRWxlbWVudHMuc29tZSgoZWwpID0+IHtcbiAgICAgICAgICAgIGlmIChjbGlja2VkWCA8IGVsLnJpZ2h0ICYmIGNsaWNrZWRYID4gZWwubGVmdCAmJiBjbGlja2VkWSA+IGVsLnRvcCAmJiBjbGlja2VkWSA8IGVsLmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIGlmKGVsLnR5cGUgPT0gJ3BhdXNlJyl7XG4gICAgICAgICAgICAgICAgICAgIHZpZGVvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGF1ZGlvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIHN0b3BEcmF3TG9vcCgpO1xuICAgICAgICAgICAgICAgICAgICBjb250cm9sRWxlbWVudHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlU3RhcnRFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xuICAgICAgICAgICAgICAgICAgICBhdWRpby5wbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVBhdXNlRWxlbWVudCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59LCBmYWxzZSk7XG5cbmZ1bmN0aW9uIGNyZWF0ZVN0YXJ0RWxlbWVudCAoKSB7XG4gICAgY29udHJvbEVsZW1lbnRzID0gW3tcbiAgICAgICAgdHlwZTogJ3N0YXJ0JyxcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICBsZWZ0OiAwLFxuICAgICAgICByaWdodDogY2FudmFzLndpZHRoLFxuICAgICAgICBib3R0b206IGNhbnZhcy53aWR0aCAtIDIwXG4gICAgfV07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVBhdXNlRWxlbWVudCAoKSB7XG4gICAgY29udHJvbEVsZW1lbnRzID0gW3tcbiAgICAgICAgdHlwZTogJ3BhdXNlJyxcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICBsZWZ0OiAwLFxuICAgICAgICByaWdodDogY2FudmFzLndpZHRoLFxuICAgICAgICBib3R0b206IGNhbnZhcy53aWR0aCAtIDIwXG4gICAgfV07XG59XG5cbmZ1bmN0aW9uIGNhbnZhc1N0YXJ0U3RhdGUgKCkge1xuICAgIHZpZGVvLndpZHRoID0gY2FudmFzLndpZHRoID0gdmlkZW8ub2Zmc2V0V2lkdGg7XG4gICAgdmlkZW8uaGVpZ2h0ID0gY2FudmFzLmhlaWdodCA9IHZpZGVvLm9mZnNldEhlaWdodDtcbiAgICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgZHJhd0JhY2tncm91bmQoY3R4LCAnYmxhY2snKTtcbiAgICBkcmF3Q2VudGVyUGxheUJ1dHRvbihjdHgsICd3aGl0ZScpO1xufVxuXG5mdW5jdGlvbiBncmF5QW5kR3JhaW4gKGltYWdlRGF0YSkge1xuICAgIC8vINC/0L7Qu9GD0YfQsNC10Lwg0L7QtNC90L7QvNC10YDQvdGL0Lkg0LzQsNGB0YHQuNCyLCDQvtC/0LjRgdGL0LLQsNGO0YnQuNC5INCy0YHQtSDQv9C40LrRgdC10LvQuCDQuNC30L7QsdGA0LDQttC10L3QuNGPXG4gICAgbGV0IHBpeGVscyA9IGltYWdlRGF0YS5kYXRhO1xuICAgIGxldCB2YWx1ZTtcblxuICAgIC8vINGG0LjQutC70LjRh9C10YHQutC4INC/0YDQtdC+0LHRgNCw0LfRg9C10Lwg0LzQsNGB0YHQuNCyLCDQuNC30LzQtdC90Y/RjyDQt9C90LDRh9C10L3QuNGPINC60YDQsNGB0L3QvtCz0L4sINC30LXQu9C10L3QvtCz0L4g0Lgg0YHQuNC90LXQs9C+INC60LDQvdCw0LvQvtCyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwaXhlbHMubGVuZ3RoOyBpICs9IDQpIHtcbiAgICAgICAgdmFsdWUgPSBNYXRoLnJhbmRvbSgpICsgMTtcbiAgICAgICAgbGV0IHIgPSBwaXhlbHNbaV07XG4gICAgICAgIGxldCBnID0gcGl4ZWxzW2krMV07XG4gICAgICAgIGxldCBiID0gcGl4ZWxzW2krMl07XG4gICAgICAgIC8vIENJRSBsdW1pbmFuY2UgZm9yIHRoZSBSR0JcbiAgICAgICAgLy8gVGhlIGh1bWFuIGV5ZSBpcyBiYWQgYXQgc2VlaW5nIHJlZCBhbmQgYmx1ZSwgc28gd2UgZGUtZW1waGFzaXplIHRoZW0uXG4gICAgICAgIGxldCB2ID0gMC4yMTI2KnIgKyAwLjcxNTIqZyArIDAuMDcyMipiO1xuXG4gICAgICAgIHBpeGVsc1tpXSA9IHBpeGVsc1tpKzFdID0gcGl4ZWxzW2krMl0gPSB2ICogdmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGltYWdlRGF0YTtcbn07XG5cbmZ1bmN0aW9uIGRyYXdCYWNrZ3JvdW5kIChjdHgsIGNvbG9yKSB7XG4gICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xufVxuXG5cblxuZnVuY3Rpb24gZHJhd0NlbnRlclBsYXlCdXR0b24gKGN0eCwgY29sb3IpIHtcbiAgICBjdHguZmlsbFN0eWxlID0gYCR7Y29sb3J9YDtcbiAgICBsZXQgdHJpYW5nbGUgPSB7XG4gICAgICAgIHdpZHRoOiAzNSxcbiAgICAgICAgaGVpZ2h0OiA1MFxuICAgIH07XG5cbiAgICB0cmlhbmdsZS5wb2ludHMgPSB7XG4gICAgICAgIHRvcDoge1xuICAgICAgICAgICAgeDogKGNhbnZhcy53aWR0aCAtIHRyaWFuZ2xlLndpZHRoKSAvIDIsXG4gICAgICAgICAgICB5OiAoY2FudmFzLmhlaWdodCAtIHRyaWFuZ2xlLmhlaWdodCkgLyAyXG4gICAgICAgIH0sXG4gICAgICAgIGJvdHRvbToge1xuICAgICAgICAgICAgeDogKGNhbnZhcy53aWR0aCAtIHRyaWFuZ2xlLndpZHRoKSAvIDIsXG4gICAgICAgICAgICB5OiAoY2FudmFzLmhlaWdodCArIHRyaWFuZ2xlLmhlaWdodCkgLyAyXG4gICAgICAgIH0sXG4gICAgICAgIHJpZ2h0OiB7XG4gICAgICAgICAgICB4OiAoY2FudmFzLndpZHRoICsgdHJpYW5nbGUud2lkdGgpIC8gMixcbiAgICAgICAgICAgIHk6IGNhbnZhcy5oZWlnaHQgLyAyXG4gICAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnRyb2xFbGVtZW50cy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3N0YXJ0JyxcbiAgICAgICAgdG9wOiB0cmlhbmdsZS5wb2ludHMudG9wLnksXG4gICAgICAgIGxlZnQ6IHRyaWFuZ2xlLnBvaW50cy50b3AueCxcbiAgICAgICAgYm90dG9tOiB0cmlhbmdsZS5wb2ludHMuYm90dG9tLnksXG4gICAgICAgIHJpZ2h0OiB0cmlhbmdsZS5wb2ludHMucmlnaHQueFxuICAgIH0pO1xuXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8odHJpYW5nbGUucG9pbnRzLnRvcC54LCB0cmlhbmdsZS5wb2ludHMudG9wLnkpO1xuICAgIGN0eC5saW5lVG8odHJpYW5nbGUucG9pbnRzLmJvdHRvbS54LCB0cmlhbmdsZS5wb2ludHMuYm90dG9tLnkpO1xuICAgIGN0eC5saW5lVG8odHJpYW5nbGUucG9pbnRzLnJpZ2h0LngsIHRyaWFuZ2xlLnBvaW50cy5yaWdodC55KTtcbiAgICBjdHguZmlsbCgpO1xufVxuXG5mdW5jdGlvbiBkcmF3Q29udHJvbHMgKGN0eCwgY29sb3IpIHtcbiAgICBjdHguZmlsbFN0eWxlID0gYCR7Y29sb3J9YDtcblxuICAgIGxldCB0cmlhbmdsZSA9IHtcbiAgICB9XG4gICAgY3R4LmZpbGxSZWN0KDgwLCBjYW52YXMuaGVpZ2h0IC0gY29udHJvbFRvcFBvaW50LCBjb250cm9sUmVjdFdpZHRoLCBjb250cm9sUmVjdEhlaWdodCk7XG4gICAgY3R4LmZpbGxSZWN0KDExMCwgY2FudmFzLmhlaWdodCAtIGNvbnRyb2xUb3BQb2ludCwgY29udHJvbFJlY3RXaWR0aCwgY29udHJvbFJlY3RIZWlnaHQpO1xufVxuXG5mdW5jdGlvbiBkcmF3U2tyYXRjaGVzIChjdHgpIHtcbiAgICBsZXQgc3Ryb2tlT3BhY2l0eSA9IE1hdGgucmFuZG9tKCkgKiAoMC44IC0gMC4yKTtcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBgcmdiYSgyNTUsIDI1NSwgMjU1LCAke3N0cm9rZU9wYWNpdHl9KWA7XG5cbiAgICBsZXQgYW1vdW50T2ZTa3JhdGNoZXMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMCArIDEpKTtcbiAgICBhbW91bnRPZlNrcmF0Y2hlcyAtPSA5ODtcbiAgICBpZihhbW91bnRPZlNrcmF0Y2hlcyA+IDApe1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgYW1vdW50T2ZTa3JhdGNoZXM7IGkrKyl7XG4gICAgICAgICAgICBza3JhdGNoKGN0eCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNrcmF0Y2ggKGN0eCkge1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBsZXQgc3RhcnRQb2ludCA9IHtcbiAgICAgICAgeDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGNhbnZhcy53aWR0aCAtIDEpKSxcbiAgICAgICAgeTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGNhbnZhcy5oZWlnaHQgLSAxKSlcbiAgICB9O1xuXG4gICAgbGV0IGVuZFBvaW50ID0ge1xuICAgICAgICB4OiBzdGFydFBvaW50LngsXG4gICAgICAgIHk6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChjYW52YXMuaGVpZ2h0IC0gc3RhcnRQb2ludC55KSlcbiAgICB9O1xuXG4gICAgY3R4Lm1vdmVUbyhzdGFydFBvaW50LngsIHN0YXJ0UG9pbnQueSk7XG4gICAgY3R4LmxpbmVUbyhlbmRQb2ludC54LCBlbmRQb2ludC55KTtcbiAgICBjdHguc3Ryb2tlKCk7XG59XG5cbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3BsYXknLCAoKSA9PiB7XG4gICAgc3RhcnREcmF3TG9vcCgpO1xufSwgZmFsc2UpO1xuXG5sZXQgbG9vcElkO1xuXG5mdW5jdGlvbiBzdGFydERyYXdMb29wICgpIHtcbiAgICBjb25zb2xlLmxvZygnc3RhcnQgZHJhdycpO1xuICAgIGlmKCFsb29wSWQpe1xuICAgICAgICBsb29wSWQgPSBzZXRJbnRlcnZhbChkcmF3TG9vcCwgZnBzKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHN0b3BEcmF3TG9vcCAoKSB7XG4gICAgY29uc29sZS5sb2coJ3N0b3AgZHJhdycpO1xuICAgIGlmKGxvb3BJZCkge1xuICAgICAgICBjbGVhckludGVydmFsKGxvb3BJZCk7XG4gICAgICAgIGxvb3BJZCA9IHVuZGVmaW5lZDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGRyYXdMb29wICgpIHtcbiAgICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGNvbnNvbGUubG9nKCdkcmF3Jyk7XG4gICAgY3R4LmRyYXdJbWFnZSh2aWRlbywgMCwgMCwgdmlkZW8ud2lkdGgsIHZpZGVvLmhlaWdodCk7XG4gICAgXG4gICAgbGV0IGltYWdlRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICBsZXQgaW1hZ2VEYXRhRmlsdGVyZWQgPSBncmF5QW5kR3JhaW4oaW1hZ2VEYXRhKTtcbiAgICBjdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YUZpbHRlcmVkLCAwLCAwKTtcblxuICAgIGRyYXdTa3JhdGNoZXMoY3R4KTtcbn1cblxuZnVuY3Rpb24gcGFyc2VTcnQodGV4dCkge1xuICAgIGxldCB0aW1lQ29uc3QgPSB7XG4gICAgICAgIHNlYzogMTAwMCxcbiAgICAgICAgbWluOiA2MCxcbiAgICAgICAgaHI6IDYwXG4gICAgfTtcbiAgICBsZXQgdGVtcCA9IHRleHQuc3BsaXQoJ1xcblxcbicpO1xuXG4gICAgbGV0IHJlc3VsdCA9IHRlbXAubWFwKChlbCkgPT4ge1xuXG4gICAgICAgIGxldCByZXMgPSB7fTtcbiAgICAgICAgbGV0IHN1YnRpdGxlID0gZWwuc3BsaXQoJ1xcbicpO1xuXG4gICAgICAgIC8vID09PSBHZXQgc3VidGl0bGUncyBudW1iZXIgPT09XG4gICAgICAgIHJlcy5udW1iZXIgPSBwYXJzZUludChzdWJ0aXRsZVswXSk7XG5cbiAgICAgICAgbGV0IHRpbWUgPSBzdWJ0aXRsZVsxXS5zcGxpdCgnIC0tPiAnKTtcblxuICAgICAgICAvLyA9PT0gQ29udmVydCBzdGFydCB0aW1lIHRvIE1TID09PVxuICAgICAgICBsZXQgc3RhcnRUaW1lID0gdGltZVswXS5zcGxpdCgnOicpO1xuICAgICAgICBsZXQgc3RhcnRUaW1lU2VjID0gcGFyc2VJbnQoc3RhcnRUaW1lWzJdLnNwbGl0KCcsJykuam9pbignJykpO1xuICAgICAgICBsZXQgc3RhcnRUaW1lTWluID0gcGFyc2VJbnQoc3RhcnRUaW1lWzFdKSAqIHRpbWVDb25zdC5taW4gKiB0aW1lQ29uc3Quc2VjO1xuICAgICAgICBsZXQgc3RhcnRUaW1lSHIgPSBwYXJzZUludChzdGFydFRpbWVbMF0pICogdGltZUNvbnN0LmhyICogdGltZUNvbnN0Lm1pbiAqIHRpbWVDb25zdC5zZWM7XG4gICAgICAgIHN0YXJ0VGltZSA9IHN0YXJ0VGltZVNlYyArIHN0YXJ0VGltZU1pblx0KyBzdGFydFRpbWVIcjtcbiAgICAgICAgcmVzLnN0YXJ0VGltZSA9IHN0YXJ0VGltZTtcblxuICAgICAgICAvLyA9PT0gQ29udmVydCBlbmQgdGltZSB0byBNUyA9PT1cbiAgICAgICAgbGV0IGVuZFRpbWUgPSB0aW1lWzFdLnNwbGl0KCc6Jyk7XG4gICAgICAgIGxldCBlbmRUaW1lU2VjID0gcGFyc2VJbnQoZW5kVGltZVsyXS5zcGxpdCgnLCcpLmpvaW4oJycpKTtcbiAgICAgICAgbGV0IGVuZFRpbWVNaW4gPSBwYXJzZUludChlbmRUaW1lWzFdKSAqIHRpbWVDb25zdC5taW4gKiB0aW1lQ29uc3Quc2VjO1xuICAgICAgICBsZXQgZW5kVGltZUhyID0gcGFyc2VJbnQoZW5kVGltZVswXSkgKiB0aW1lQ29uc3QuaHIgKiB0aW1lQ29uc3QubWluICogdGltZUNvbnN0LnNlYztcbiAgICAgICAgZW5kVGltZSA9IGVuZFRpbWVTZWMgKyBlbmRUaW1lTWluXHQrIGVuZFRpbWVIcjtcbiAgICAgICAgcmVzLmVuZFRpbWUgPSBlbmRUaW1lO1xuXG4gICAgICAgIHJlcy50aW1lTGVuZ3RoID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcblxuICAgICAgICAvLyA9PT0gSm9pbiBzdWJ0aXRsZSBjb250ZW50ID09PVxuICAgICAgICBzdWJ0aXRsZS5zcGxpY2UoMCwgMik7XG4gICAgICAgIHJlcy5jb250ZW50ID0gc3VidGl0bGU7XG5cbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHQ7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
