"use strict";function grayAndGrain(t){for(var e=t.data,o=void 0,i=0;i<e.length;i+=4){o=Math.random()+1;var n=e[i],a=e[i+1],s=e[i+2],r=.2126*n+.7152*a+.0722*s;e[i]=e[i+1]=e[i+2]=r*o}return t}function drawBackground(t,e){t.fillStyle=e,t.fillRect(0,0,canvas.width,canvas.height)}function drawCenterPlayButton(t,e){t.fillStyle=""+e;var o={width:35,height:50};o.points={top:{x:(canvas.width-o.width)/2,y:(canvas.height-o.height)/2},bottom:{x:(canvas.width-o.width)/2,y:(canvas.height+o.height)/2},right:{x:(canvas.width+o.width)/2,y:canvas.height/2}},controlElements.push({type:"start",top:o.points.top.y,left:o.points.top.x,bottom:o.points.bottom.y,right:o.points.right.x}),t.beginPath(),t.moveTo(o.points.top.x,o.points.top.y),t.lineTo(o.points.bottom.x,o.points.bottom.y),t.lineTo(o.points.right.x,o.points.right.y),t.fill()}function drawControls(t,e){t.fillStyle=""+e;t.fillRect(80,canvas.height-controlTopPoint,controlRectWidth,controlRectHeight),t.fillRect(110,canvas.height-controlTopPoint,controlRectWidth,controlRectHeight)}function drawSkratches(){var t=Math.random()*(.8-.2);ctx.strokeStyle="rgba(255, 255, 255, "+t+")";var e=Math.floor(101*Math.random());if(e-=98,e>0)for(var o=0;o<e;o++)skratch()}function skratch(){ctx.beginPath();var t={x:Math.floor(Math.random()*(canvas.width-1)),y:Math.floor(Math.random()*(canvas.height-1))},e={x:t.x,y:Math.floor(Math.random()*(canvas.height-t.y))};ctx.moveTo(t.x,t.y),ctx.lineTo(e.x,e.y),ctx.stroke()}function startDrawLoop(){loopId||isSubtitleShown?"undefined"!=typeof subtitles[subtitleIndex]&&(subTimeout=setTimeout(hideSub,subtitles[subtitleIndex].timeLength/2)):loopId=setInterval(drawLoop,fps)}function stopDrawLoop(){loopId&&(clearInterval(loopId),loopId=void 0)}function drawLoop(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(video,0,0,video.width,video.height);var t=ctx.getImageData(0,0,canvas.width,canvas.height),e=grayAndGrain(t);ctx.putImageData(e,0,0),drawSkratches()}function _onInputChange(t){var e=new FileReader;switch(!0){case t.target.classList.contains("links-form__video"):e.readAsDataURL(t.target.files[0]),e.addEventListener("load",function(t){createVideo(e.result)});break;case t.target.classList.contains("links-form__sub"):e.readAsText(t.target.files[0]),e.addEventListener("load",function(t){subtitles=parseSrt(e.result)});break;case t.target.classList.contains("links-form__audio"):e.readAsDataURL(t.target.files[0]),e.addEventListener("load",function(t){createAudio(e.result)})}}function checkInputs(t){t.preventDefault();var e=document.querySelectorAll(".links-form__input"),o=!0;e.forEach(function(t){""===t.value&&(o=!1)}),o&&(showPlayer(),initCanvas())}function createVideo(t){video=document.createElement("video"),video.src=t,video.defaultMuted=!0,video.classList.add("player__video"),video.width=700,video.height=400,document.querySelector(".hidden-elements").appendChild(video),video.addEventListener("play",startDrawLoop,!1),video.addEventListener("pause",stopDrawLoop,!1),video.addEventListener("timeupdate",function(t){var e=(1e3*t.target.currentTime).toFixed();"undefined"!=typeof subtitles[subtitleIndex]&&e>=subtitles[subtitleIndex].endTime&&(isSubtitleShown||showSub(subtitles[subtitleIndex]))}),video.addEventListener("ended",function(t){audio.stop(),stopDrawLoop()},!1)}function createAudio(t){audio=document.createElement("audio"),audio.src=t,audio.autoplay=!1,audio.classList.add("player__audio"),document.querySelector(".hidden-elements").appendChild(audio)}function showPlayer(){linksEl.classList.add("hidden"),playerEl.classList.remove("hidden")}function initCanvas(){canvas=document.querySelector(".player__canvas"),canvasStartState(),canvas.addEventListener("click",function(t){var e=t.pageX-t.target.offsetLeft,o=t.pageY-t.target.offsetTop;controlElements.some(function(t){e<t.right&&e>t.left&&o>t.top&&o<t.bottom&&("pause"==t.type?(isSubtitleShown?(stopSubTimeout(),audio.pause()):(video.pause(),audio.pause(),stopDrawLoop()),controlElements=[],createStartElement()):isSubtitleShown?(startSubTimeout(),audio.play()):(video.play(),audio.play(),createPauseElement()))})},!1)}function createStartElement(){controlElements=[{type:"start",top:0,left:0,right:canvas.width,bottom:canvas.width-20}]}function createPauseElement(){controlElements=[{type:"pause",top:0,left:0,right:canvas.width,bottom:canvas.width-20}]}function canvasStartState(){video.width=canvas.width=video.offsetWidth,video.height=canvas.height=video.offsetHeight;var t=canvas.getContext("2d");drawBackground(t,"black"),drawCenterPlayButton(t,"white")}function parseSrt(t){var e={sec:1e3,min:60,hr:60},o=t.split("\n\n"),i=o.map(function(t){var o={},i=t.split("\n");o.number=parseInt(i[0]);var n=i[1].split(" --> "),a=n[0].split(":"),s=parseInt(a[2].split(",").join("")),r=parseInt(a[1])*e.min*e.sec,c=parseInt(a[0])*e.hr*e.min*e.sec;a=s+r+c,o.startTime=a;var d=n[1].split(":"),l=parseInt(d[2].split(",").join("")),u=parseInt(d[1])*e.min*e.sec,h=parseInt(d[0])*e.hr*e.min*e.sec;return d=l+u+h,o.endTime=d,o.timeLength=d-a,i.splice(0,2),o.content=i,o});return i}function showSub(t){isSubtitleShown=!0,video.pause(),drawSub(t)}function drawSub(t){ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.font="1.5em Oranienbaum, serif";var e=24*t.content.length+12*(t.content.length-1),o=(canvas.height-e)/2;t.content.forEach(function(t,e){var i=o+24*e+12*e,n=.1*canvas.width;ctx.fillText(t,n,i)})}function hideSub(){isSubtitleShown&&(isSubtitleShown=!1,subtitleIndex++,video.play()),clearTimeout(subTimeout),subTimeout=void 0,controlElements=[],createPauseElement()}function stopSubTimeout(){subTimeout&&(clearTimeout(subTimeout),subTimeout=void 0)}function startSubTimeout(){subTimeout=setTimeout(hideSub,subtitles[subtitleIndex].timeLength)}var canvas=document.querySelector(".player__canvas"),ctx=canvas.getContext("2d"),controlBottomPoint=10,controlTopPoint=60,controlTrianglePoint=35,controlRectHeight=50,controlRectWidth=20,fps=1e3/60,loopId=void 0,linksForm=document.querySelector(".links-form"),linksEl=document.querySelector(".links"),playerEl=document.querySelector(".player"),submitEl=document.querySelector(".links-form__submit"),isSubtitleShown=!1,subtitles=void 0,subTimeout=void 0;linksForm.addEventListener("change",_onInputChange,!1),submitEl.addEventListener("click",checkInputs,!1);var video=void 0,canvas=void 0,audio=void 0,controlBottomPoint=10,controlTopPoint=60,controlTrianglePoint=35,controlRectHeight=50,controlRectWidth=20,fps=1e3/60,videoWidth=void 0,videoHeight=void 0,videoSizeRatio=void 0,controlElements=[],reader=new FileReader,srt=void 0,subtitleIndex=0;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJkcmF3LmpzIiwiaW5wdXQuanMiLCJzdWJzLmpzIl0sIm5hbWVzIjpbImdyYXlBbmRHcmFpbiIsImltYWdlRGF0YSIsInBpeGVscyIsImRhdGEiLCJ2YWx1ZSIsImkiLCJsZW5ndGgiLCJNYXRoIiwicmFuZG9tIiwiciIsImciLCJiIiwidiIsImRyYXdCYWNrZ3JvdW5kIiwiY3R4IiwiY29sb3IiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImNhbnZhcyIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhd0NlbnRlclBsYXlCdXR0b24iLCJ0cmlhbmdsZSIsInBvaW50cyIsInRvcCIsIngiLCJ5IiwiYm90dG9tIiwicmlnaHQiLCJjb250cm9sRWxlbWVudHMiLCJwdXNoIiwidHlwZSIsImxlZnQiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJmaWxsIiwiZHJhd0NvbnRyb2xzIiwiY29udHJvbFRvcFBvaW50IiwiY29udHJvbFJlY3RXaWR0aCIsImNvbnRyb2xSZWN0SGVpZ2h0IiwiZHJhd1NrcmF0Y2hlcyIsInN0cm9rZU9wYWNpdHkiLCJzdHJva2VTdHlsZSIsImFtb3VudE9mU2tyYXRjaGVzIiwiZmxvb3IiLCJza3JhdGNoIiwic3RhcnRQb2ludCIsImVuZFBvaW50Iiwic3Ryb2tlIiwic3RhcnREcmF3TG9vcCIsImxvb3BJZCIsImlzU3VidGl0bGVTaG93biIsInN1YnRpdGxlcyIsInN1YnRpdGxlSW5kZXgiLCJzdWJUaW1lb3V0Iiwic2V0VGltZW91dCIsImhpZGVTdWIiLCJ0aW1lTGVuZ3RoIiwic2V0SW50ZXJ2YWwiLCJkcmF3TG9vcCIsImZwcyIsInN0b3BEcmF3TG9vcCIsImNsZWFySW50ZXJ2YWwiLCJ1bmRlZmluZWQiLCJjbGVhclJlY3QiLCJkcmF3SW1hZ2UiLCJ2aWRlbyIsImdldEltYWdlRGF0YSIsImltYWdlRGF0YUZpbHRlcmVkIiwicHV0SW1hZ2VEYXRhIiwiX29uSW5wdXRDaGFuZ2UiLCJlIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsInRhcmdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVhZEFzRGF0YVVSTCIsImZpbGVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNyZWF0ZVZpZGVvIiwicmVzdWx0IiwicmVhZEFzVGV4dCIsInBhcnNlU3J0IiwiY3JlYXRlQXVkaW8iLCJjaGVja0lucHV0cyIsInByZXZlbnREZWZhdWx0IiwiaW5wdXRzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwidmFsaWRhdGlvbiIsImZvckVhY2giLCJpbnB1dCIsInNob3dQbGF5ZXIiLCJpbml0Q2FudmFzIiwic3JjIiwiY3JlYXRlRWxlbWVudCIsImRlZmF1bHRNdXRlZCIsImFkZCIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmRDaGlsZCIsInRpbWUiLCJjdXJyZW50VGltZSIsInRvRml4ZWQiLCJlbmRUaW1lIiwic2hvd1N1YiIsImF1ZGlvIiwic3RvcCIsImF1dG9wbGF5IiwibGlua3NFbCIsInBsYXllckVsIiwicmVtb3ZlIiwiY2FudmFzU3RhcnRTdGF0ZSIsImNsaWNrZWRYIiwicGFnZVgiLCJvZmZzZXRMZWZ0IiwiY2xpY2tlZFkiLCJwYWdlWSIsIm9mZnNldFRvcCIsInNvbWUiLCJlbCIsInN0b3BTdWJUaW1lb3V0IiwicGF1c2UiLCJjcmVhdGVTdGFydEVsZW1lbnQiLCJzdGFydFN1YlRpbWVvdXQiLCJwbGF5IiwiY3JlYXRlUGF1c2VFbGVtZW50Iiwib2Zmc2V0V2lkdGgiLCJvZmZzZXRIZWlnaHQiLCJnZXRDb250ZXh0IiwidGV4dCIsInRpbWVDb25zdCIsInNlYyIsIm1pbiIsImhyIiwidGVtcCIsInNwbGl0IiwibWFwIiwicmVzIiwic3VidGl0bGUiLCJudW1iZXIiLCJwYXJzZUludCIsInN0YXJ0VGltZSIsInN0YXJ0VGltZVNlYyIsImpvaW4iLCJzdGFydFRpbWVNaW4iLCJzdGFydFRpbWVIciIsImVuZFRpbWVTZWMiLCJlbmRUaW1lTWluIiwiZW5kVGltZUhyIiwic3BsaWNlIiwiY29udGVudCIsInN1YiIsImRyYXdTdWIiLCJmb250IiwidGV4dEhlaWdodCIsInRvcFBhZGRpbmciLCJmaWxsVGV4dCIsImNsZWFyVGltZW91dCIsImNvbnRyb2xCb3R0b21Qb2ludCIsImNvbnRyb2xUcmlhbmdsZVBvaW50IiwibGlua3NGb3JtIiwic3VibWl0RWwiLCJ2aWRlb1dpZHRoIiwidmlkZW9IZWlnaHQiLCJ2aWRlb1NpemVSYXRpbyIsInNydCJdLCJtYXBwaW5ncyI6IkFBQUEsWUNXQSxTQUFTQSxjQUFjQyxHQU1uQixJQUFLLEdBSkRDLEdBQVNELEVBQVVFLEtBQ25CQyxFQUFBLE9BR0tDLEVBQUksRUFBR0EsRUFBSUgsRUFBT0ksT0FBUUQsR0FBSyxFQUFHLENBQ3ZDRCxFQUFRRyxLQUFLQyxTQUFXLENBQ3hCLElBQUlDLEdBQUlQLEVBQU9HLEdBQ1hLLEVBQUlSLEVBQU9HLEVBQUUsR0FDYk0sRUFBSVQsRUFBT0csRUFBRSxHQUdiTyxFQUFJLE1BQU9ILEVBQUksTUFBT0MsRUFBSSxNQUFPQyxDQUVyQ1QsR0FBT0csR0FBS0gsRUFBT0csRUFBRSxHQUFLSCxFQUFPRyxFQUFFLEdBQUtPLEVBQUlSLEVBR2hELE1BQU9ILEdBR1gsUUFBU1ksZ0JBQWdCQyxFQUFLQyxHQUMxQkQsRUFBSUUsVUFBWUQsRUFDaEJELEVBQUlHLFNBQVMsRUFBRyxFQUFHQyxPQUFPQyxNQUFPRCxPQUFPRSxRQUc1QyxRQUFTQyxzQkFBc0JQLEVBQUtDLEdBQ2hDRCxFQUFJRSxVQUFKLEdBQW1CRCxDQUNuQixJQUFJTyxJQUNBSCxNQUFPLEdBQ1BDLE9BQVEsR0FHWkUsR0FBU0MsUUFDTEMsS0FDSUMsR0FBSVAsT0FBT0MsTUFBUUcsRUFBU0gsT0FBUyxFQUNyQ08sR0FBSVIsT0FBT0UsT0FBU0UsRUFBU0YsUUFBVSxHQUUzQ08sUUFDSUYsR0FBSVAsT0FBT0MsTUFBUUcsRUFBU0gsT0FBUyxFQUNyQ08sR0FBSVIsT0FBT0UsT0FBU0UsRUFBU0YsUUFBVSxHQUUzQ1EsT0FDSUgsR0FBSVAsT0FBT0MsTUFBUUcsRUFBU0gsT0FBUyxFQUNy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QUNwQkQsaUJBQW1CLEdBQ25Cc0IsSUFBTSxJQUFPLEdBRWZ1RyxXQUFBLE9BQ0FDLFlBQUEsT0FDQUMsZUFBQSxPQUVBekksbUJBRUE0QyxPQUFTLEdBQUlDLFlBQ2I2RixJQUFBLE9HaEJBakgsY0FBZ0IiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCB2aWRlbywgY2FudmFzLCBhdWRpbztcblxuY29uc3QgY29udHJvbEJvdHRvbVBvaW50ID0gMTA7XG5jb25zdCBjb250cm9sVG9wUG9pbnQgPSA2MDtcbmNvbnN0IGNvbnRyb2xUcmlhbmdsZVBvaW50ID0gMzU7XG5jb25zdCBjb250cm9sUmVjdEhlaWdodCA9IDUwO1xuY29uc3QgY29udHJvbFJlY3RXaWR0aCA9IDIwO1xuY29uc3QgZnBzID0gMTAwMCAvIDYwO1xuXG5sZXQgdmlkZW9XaWR0aCxcbiAgICB2aWRlb0hlaWdodCxcbiAgICB2aWRlb1NpemVSYXRpbztcblxubGV0IGNvbnRyb2xFbGVtZW50cyA9IFtdO1xuXG5sZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbmxldCBzcnQ7XG5cblxuZnVuY3Rpb24gc2hvd1BsYXllciAoKSB7XG4gICAgbGlua3NFbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICBwbGF5ZXJFbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbn1cblxuZnVuY3Rpb24gaW5pdENhbnZhcyAoKSB7XG4gICAgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcl9fY2FudmFzJyk7XG4gICAgY2FudmFzU3RhcnRTdGF0ZSgpO1xuXG4gICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgbGV0IGNsaWNrZWRYID0gZS5wYWdlWCAtIGUudGFyZ2V0Lm9mZnNldExlZnQ7XG4gICAgICAgIGxldCBjbGlja2VkWSA9IGUucGFnZVkgLSBlLnRhcmdldC5vZmZzZXRUb3A7XG4gICAgICAgIGNvbnRyb2xFbGVtZW50cy5zb21lKChlbCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNsaWNrZWRYIDwgZWwucmlnaHQgJiYgY2xpY2tlZFggPiBlbC5sZWZ0ICYmIGNsaWNrZWRZID4gZWwudG9wICYmIGNsaWNrZWRZIDwgZWwuYm90dG9tKSB7XG4gICAgICAgICAgICAgICAgaWYoZWwudHlwZSA9PSAncGF1c2UnKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoIWlzU3VidGl0bGVTaG93bil7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlby5wYXVzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW8ucGF1c2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3BEcmF3TG9vcCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFN1YlRpbWVvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29udHJvbEVsZW1lbnRzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVN0YXJ0RWxlbWVudCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFpc1N1YnRpdGxlU2hvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVBhdXNlRWxlbWVudCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRTdWJUaW1lb3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdWRpby5wbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sIGZhbHNlKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3RhcnRFbGVtZW50ICgpIHtcbiAgICBjb250cm9sRWxlbWVudHMgPSBbe1xuICAgICAgICB0eXBlOiAnc3RhcnQnLFxuICAgICAgICB0b3A6IDAsXG4gICAgICAgIGxlZnQ6IDAsXG4gICAgICAgIHJpZ2h0OiBjYW52YXMud2lkdGgsXG4gICAgICAgIGJvdHRvbTogY2FudmFzLndpZHRoIC0gMjBcbiAgICB9XTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUGF1c2VFbGVtZW50ICgpIHtcbiAgICBjb250cm9sRWxlbWVudHMgPSBbe1xuICAgICAgICB0eXBlOiAncGF1c2UnLFxuICAgICAgICB0b3A6IDAsXG4gICAgICAgIGxlZnQ6IDAsXG4gICAgICAgIHJpZ2h0OiBjYW52YXMud2lkdGgsXG4gICAgICAgIGJvdHRvbTogY2FudmFzLndpZHRoIC0gMjBcbiAgICB9XTtcbn1cblxuZnVuY3Rpb24gY2FudmFzU3RhcnRTdGF0ZSAoKSB7XG4gICAgdmlkZW8ud2lkdGggPSBjYW52YXMud2lkdGggPSB2aWRlby5vZmZzZXRXaWR0aDtcbiAgICB2aWRlby5oZWlnaHQgPSBjYW52YXMuaGVpZ2h0ID0gdmlkZW8ub2Zmc2V0SGVpZ2h0O1xuICAgIGxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBkcmF3QmFja2dyb3VuZChjdHgsICdibGFjaycpO1xuICAgIGRyYXdDZW50ZXJQbGF5QnV0dG9uKGN0eCwgJ3doaXRlJyk7XG59XG4iLCJjb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyX19jYW52YXMnKTtcbmxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuY29uc3QgY29udHJvbEJvdHRvbVBvaW50ID0gMTA7XG5jb25zdCBjb250cm9sVG9wUG9pbnQgPSA2MDtcbmNvbnN0IGNvbnRyb2xUcmlhbmdsZVBvaW50ID0gMzU7XG5jb25zdCBjb250cm9sUmVjdEhlaWdodCA9IDUwO1xuY29uc3QgY29udHJvbFJlY3RXaWR0aCA9IDIwO1xuY29uc3QgZnBzID0gMTAwMCAvIDYwO1xubGV0IGxvb3BJZDtcblxuZnVuY3Rpb24gZ3JheUFuZEdyYWluIChpbWFnZURhdGEpIHtcbiAgICAvLyDQv9C+0LvRg9GH0LDQtdC8INC+0LTQvdC+0LzQtdGA0L3Ri9C5INC80LDRgdGB0LjQsiwg0L7Qv9C40YHRi9Cy0LDRjtGJ0LjQuSDQstGB0LUg0L/QuNC60YHQtdC70Lgg0LjQt9C+0LHRgNCw0LbQtdC90LjRj1xuICAgIGxldCBwaXhlbHMgPSBpbWFnZURhdGEuZGF0YTtcbiAgICBsZXQgdmFsdWU7XG5cbiAgICAvLyDRhtC40LrQu9C40YfQtdGB0LrQuCDQv9GA0LXQvtCx0YDQsNC30YPQtdC8INC80LDRgdGB0LjQsiwg0LjQt9C80LXQvdGP0Y8g0LfQvdCw0YfQtdC90LjRjyDQutGA0LDRgdC90L7Qs9C+LCDQt9C10LvQtdC90L7Qs9C+INC4INGB0LjQvdC10LPQviDQutCw0L3QsNC70L7QslxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGl4ZWxzLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICAgIHZhbHVlID0gTWF0aC5yYW5kb20oKSArIDE7XG4gICAgICAgIGxldCByID0gcGl4ZWxzW2ldO1xuICAgICAgICBsZXQgZyA9IHBpeGVsc1tpKzFdO1xuICAgICAgICBsZXQgYiA9IHBpeGVsc1tpKzJdO1xuICAgICAgICAvLyBDSUUgbHVtaW5hbmNlIGZvciB0aGUgUkdCXG4gICAgICAgIC8vIFRoZSBodW1hbiBleWUgaXMgYmFkIGF0IHNlZWluZyByZWQgYW5kIGJsdWUsIHNvIHdlIGRlLWVtcGhhc2l6ZSB0aGVtLlxuICAgICAgICBsZXQgdiA9IDAuMjEyNipyICsgMC43MTUyKmcgKyAwLjA3MjIqYjtcblxuICAgICAgICBwaXhlbHNbaV0gPSBwaXhlbHNbaSsxXSA9IHBpeGVsc1tpKzJdID0gdiAqIHZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiBpbWFnZURhdGE7XG59O1xuXG5mdW5jdGlvbiBkcmF3QmFja2dyb3VuZCAoY3R4LCBjb2xvcikge1xuICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjtcbiAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbn1cblxuZnVuY3Rpb24gZHJhd0NlbnRlclBsYXlCdXR0b24gKGN0eCwgY29sb3IpIHtcbiAgICBjdHguZmlsbFN0eWxlID0gYCR7Y29sb3J9YDtcbiAgICBsZXQgdHJpYW5nbGUgPSB7XG4gICAgICAgIHdpZHRoOiAzNSxcbiAgICAgICAgaGVpZ2h0OiA1MFxuICAgIH07XG5cbiAgICB0cmlhbmdsZS5wb2ludHMgPSB7XG4gICAgICAgIHRvcDoge1xuICAgICAgICAgICAgeDogKGNhbnZhcy53aWR0aCAtIHRyaWFuZ2xlLndpZHRoKSAvIDIsXG4gICAgICAgICAgICB5OiAoY2FudmFzLmhlaWdodCAtIHRyaWFuZ2xlLmhlaWdodCkgLyAyXG4gICAgICAgIH0sXG4gICAgICAgIGJvdHRvbToge1xuICAgICAgICAgICAgeDogKGNhbnZhcy53aWR0aCAtIHRyaWFuZ2xlLndpZHRoKSAvIDIsXG4gICAgICAgICAgICB5OiAoY2FudmFzLmhlaWdodCArIHRyaWFuZ2xlLmhlaWdodCkgLyAyXG4gICAgICAgIH0sXG4gICAgICAgIHJpZ2h0OiB7XG4gICAgICAgICAgICB4OiAoY2FudmFzLndpZHRoICsgdHJpYW5nbGUud2lkdGgpIC8gMixcbiAgICAgICAgICAgIHk6IGNhbnZhcy5oZWlnaHQgLyAyXG4gICAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnRyb2xFbGVtZW50cy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3N0YXJ0JyxcbiAgICAgICAgdG9wOiB0cmlhbmdsZS5wb2ludHMudG9wLnksXG4gICAgICAgIGxlZnQ6IHRyaWFuZ2xlLnBvaW50cy50b3AueCxcbiAgICAgICAgYm90dG9tOiB0cmlhbmdsZS5wb2ludHMuYm90dG9tLnksXG4gICAgICAgIHJpZ2h0OiB0cmlhbmdsZS5wb2ludHMucmlnaHQueFxuICAgIH0pO1xuXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8odHJpYW5nbGUucG9pbnRzLnRvcC54LCB0cmlhbmdsZS5wb2ludHMudG9wLnkpO1xuICAgIGN0eC5saW5lVG8odHJpYW5nbGUucG9pbnRzLmJvdHRvbS54LCB0cmlhbmdsZS5wb2ludHMuYm90dG9tLnkpO1xuICAgIGN0eC5saW5lVG8odHJpYW5nbGUucG9pbnRzLnJpZ2h0LngsIHRyaWFuZ2xlLnBvaW50cy5yaWdodC55KTtcbiAgICBjdHguZmlsbCgpO1xufVxuXG5mdW5jdGlvbiBkcmF3Q29udHJvbHMgKGN0eCwgY29sb3IpIHtcbiAgICBjdHguZmlsbFN0eWxlID0gYCR7Y29sb3J9YDtcblxuICAgIGxldCB0cmlhbmdsZSA9IHtcbiAgICB9XG4gICAgY3R4LmZpbGxSZWN0KDgwLCBjYW52YXMuaGVpZ2h0IC0gY29udHJvbFRvcFBvaW50LCBjb250cm9sUmVjdFdpZHRoLCBjb250cm9sUmVjdEhlaWdodCk7XG4gICAgY3R4LmZpbGxSZWN0KDExMCwgY2FudmFzLmhlaWdodCAtIGNvbnRyb2xUb3BQb2ludCwgY29udHJvbFJlY3RXaWR0aCwgY29udHJvbFJlY3RIZWlnaHQpO1xufVxuXG5mdW5jdGlvbiBkcmF3U2tyYXRjaGVzICgpIHtcbiAgICBsZXQgc3Ryb2tlT3BhY2l0eSA9IE1hdGgucmFuZG9tKCkgKiAoMC44IC0gMC4yKTtcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBgcmdiYSgyNTUsIDI1NSwgMjU1LCAke3N0cm9rZU9wYWNpdHl9KWA7XG5cbiAgICBsZXQgYW1vdW50T2ZTa3JhdGNoZXMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMCArIDEpKTtcbiAgICBhbW91bnRPZlNrcmF0Y2hlcyAtPSA5ODtcbiAgICBpZihhbW91bnRPZlNrcmF0Y2hlcyA+IDApe1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgYW1vdW50T2ZTa3JhdGNoZXM7IGkrKyl7XG4gICAgICAgICAgICBza3JhdGNoKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNrcmF0Y2ggKCkge1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBsZXQgc3RhcnRQb2ludCA9IHtcbiAgICAgICAgeDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGNhbnZhcy53aWR0aCAtIDEpKSxcbiAgICAgICAgeTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGNhbnZhcy5oZWlnaHQgLSAxKSlcbiAgICB9O1xuXG4gICAgbGV0IGVuZFBvaW50ID0ge1xuICAgICAgICB4OiBzdGFydFBvaW50LngsXG4gICAgICAgIHk6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChjYW52YXMuaGVpZ2h0IC0gc3RhcnRQb2ludC55KSlcbiAgICB9O1xuXG4gICAgY3R4Lm1vdmVUbyhzdGFydFBvaW50LngsIHN0YXJ0UG9pbnQueSk7XG4gICAgY3R4LmxpbmVUbyhlbmRQb2ludC54LCBlbmRQb2ludC55KTtcbiAgICBjdHguc3Ryb2tlKCk7XG59XG5cbmZ1bmN0aW9uIHN0YXJ0RHJhd0xvb3AgKCkge1xuICAgIGlmKCFsb29wSWQgJiYgIWlzU3VidGl0bGVTaG93bil7XG4gICAgICAgIGxvb3BJZCA9IHNldEludGVydmFsKGRyYXdMb29wLCBmcHMpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHN1YnRpdGxlc1tzdWJ0aXRsZUluZGV4XSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgc3ViVGltZW91dCA9IHNldFRpbWVvdXQoaGlkZVN1Yiwgc3VidGl0bGVzW3N1YnRpdGxlSW5kZXhdLnRpbWVMZW5ndGggLyAyKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHN0b3BEcmF3TG9vcCAoKSB7XG4gICAgaWYobG9vcElkKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwobG9vcElkKTtcbiAgICAgICAgbG9vcElkID0gdW5kZWZpbmVkO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZHJhd0xvb3AgKCkge1xuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICBjdHguZHJhd0ltYWdlKHZpZGVvLCAwLCAwLCB2aWRlby53aWR0aCwgdmlkZW8uaGVpZ2h0KTtcbiAgICBcbiAgICBsZXQgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGxldCBpbWFnZURhdGFGaWx0ZXJlZCA9IGdyYXlBbmRHcmFpbihpbWFnZURhdGEpO1xuICAgIGN0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhRmlsdGVyZWQsIDAsIDApO1xuXG4gICAgZHJhd1NrcmF0Y2hlcygpO1xufVxuIiwiY29uc3QgbGlua3NGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxpbmtzLWZvcm0nKTtcbmNvbnN0IGxpbmtzRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubGlua3MnKTtcbmNvbnN0IHBsYXllckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcicpO1xuY29uc3Qgc3VibWl0RWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubGlua3MtZm9ybV9fc3VibWl0Jyk7XG5cbmxldCBpc1N1YnRpdGxlU2hvd24gPSBmYWxzZTtcbmxldCBzdWJ0aXRsZXM7XG5sZXQgc3ViVGltZW91dDtcblxubGlua3NGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIF9vbklucHV0Q2hhbmdlLCBmYWxzZSk7XG5zdWJtaXRFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNoZWNrSW5wdXRzLCBmYWxzZSk7XG5cbmZ1bmN0aW9uIF9vbklucHV0Q2hhbmdlIChlKSB7XG4gICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICBjYXNlIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbGlua3MtZm9ybV9fdmlkZW8nKTpcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZS50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICByZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIChlKSA9PiB7XG4gICAgICAgICAgICBjcmVhdGVWaWRlbyhyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgIGNhc2UgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdsaW5rcy1mb3JtX19zdWInKTpcbiAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZS50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICByZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIChlKSA9PiB7XG4gICAgICAgICAgICBzdWJ0aXRsZXMgPSBwYXJzZVNydChyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgIGNhc2UgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdsaW5rcy1mb3JtX19hdWRpbycpOlxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChlLnRhcmdldC5maWxlc1swXSk7XG4gICAgICAgIHJlYWRlci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKGUpID0+IHtcbiAgICAgICAgICAgIGNyZWF0ZUF1ZGlvKHJlYWRlci5yZXN1bHQpO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjaGVja0lucHV0cyAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmxpbmtzLWZvcm1fX2lucHV0Jyk7XG4gICAgbGV0IHZhbGlkYXRpb24gPSB0cnVlO1xuXG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgIGlmKGlucHV0LnZhbHVlID09PSAnJyl7XG4gICAgICAgICAgICB2YWxpZGF0aW9uID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmKHZhbGlkYXRpb24pIHtcbiAgICAgICAgc2hvd1BsYXllcigpO1xuICAgICAgICBpbml0Q2FudmFzKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVWaWRlbyAoc3JjKSB7XG4gICAgdmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpO1xuICAgIHZpZGVvLnNyYyA9IHNyYztcbiAgICB2aWRlby5kZWZhdWx0TXV0ZWQgPSB0cnVlO1xuICAgIHZpZGVvLmNsYXNzTGlzdC5hZGQoJ3BsYXllcl9fdmlkZW8nKTtcbiAgICB2aWRlby53aWR0aCA9IDcwMDtcbiAgICB2aWRlby5oZWlnaHQgPSA0MDA7XG4gICAgXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhpZGRlbi1lbGVtZW50cycpLmFwcGVuZENoaWxkKHZpZGVvKTtcblxuICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3BsYXknLCBzdGFydERyYXdMb29wLCBmYWxzZSk7XG5cbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCdwYXVzZScsIHN0b3BEcmF3TG9vcCwgZmFsc2UpO1xuXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsIChlKSA9PiB7XG4gICAgICAgIGxldCB0aW1lID0gKGUudGFyZ2V0LmN1cnJlbnRUaW1lICogMTAwMCkudG9GaXhlZCgpO1xuICAgICAgICBpZiAodHlwZW9mIHN1YnRpdGxlc1tzdWJ0aXRsZUluZGV4XSAhPT0gJ3VuZGVmaW5lZCcgJiYgdGltZSA+PSBzdWJ0aXRsZXNbc3VidGl0bGVJbmRleF0uZW5kVGltZSkge1xuICAgICAgICAgICAgaWYgKCFpc1N1YnRpdGxlU2hvd24pIHtcbiAgICAgICAgICAgICAgICBzaG93U3ViKHN1YnRpdGxlc1tzdWJ0aXRsZUluZGV4XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgKGUpID0+IHtcbiAgICAgICAgYXVkaW8uc3RvcCgpO1xuICAgICAgICBzdG9wRHJhd0xvb3AoKTtcbiAgICB9LCBmYWxzZSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUF1ZGlvIChzcmMpIHtcbiAgICBhdWRpbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2F1ZGlvJyk7XG5cdGF1ZGlvLnNyYyA9IHNyYztcblx0YXVkaW8uYXV0b3BsYXkgPSBmYWxzZTtcbiAgICBhdWRpby5jbGFzc0xpc3QuYWRkKCdwbGF5ZXJfX2F1ZGlvJyk7XG5cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGlkZGVuLWVsZW1lbnRzJykuYXBwZW5kQ2hpbGQoYXVkaW8pO1xufVxuIiwibGV0IHN1YnRpdGxlSW5kZXggPSAwO1xuXG5mdW5jdGlvbiBwYXJzZVNydCAodGV4dCkge1xuICAgIGxldCB0aW1lQ29uc3QgPSB7XG4gICAgICAgIHNlYzogMTAwMCxcbiAgICAgICAgbWluOiA2MCxcbiAgICAgICAgaHI6IDYwXG4gICAgfTtcbiAgICBsZXQgdGVtcCA9IHRleHQuc3BsaXQoJ1xcblxcbicpO1xuXG4gICAgbGV0IHJlc3VsdCA9IHRlbXAubWFwKChlbCkgPT4ge1xuXG4gICAgICAgIGxldCByZXMgPSB7fTtcbiAgICAgICAgbGV0IHN1YnRpdGxlID0gZWwuc3BsaXQoJ1xcbicpO1xuXG4gICAgICAgIC8vID09PSBHZXQgc3VidGl0bGUncyBudW1iZXIgPT09XG4gICAgICAgIHJlcy5udW1iZXIgPSBwYXJzZUludChzdWJ0aXRsZVswXSk7XG5cbiAgICAgICAgbGV0IHRpbWUgPSBzdWJ0aXRsZVsxXS5zcGxpdCgnIC0tPiAnKTtcblxuICAgICAgICAvLyA9PT0gQ29udmVydCBzdGFydCB0aW1lIHRvIE1TID09PVxuICAgICAgICBsZXQgc3RhcnRUaW1lID0gdGltZVswXS5zcGxpdCgnOicpO1xuICAgICAgICBsZXQgc3RhcnRUaW1lU2VjID0gcGFyc2VJbnQoc3RhcnRUaW1lWzJdLnNwbGl0KCcsJykuam9pbignJykpO1xuICAgICAgICBsZXQgc3RhcnRUaW1lTWluID0gcGFyc2VJbnQoc3RhcnRUaW1lWzFdKSAqIHRpbWVDb25zdC5taW4gKiB0aW1lQ29uc3Quc2VjO1xuICAgICAgICBsZXQgc3RhcnRUaW1lSHIgPSBwYXJzZUludChzdGFydFRpbWVbMF0pICogdGltZUNvbnN0LmhyICogdGltZUNvbnN0Lm1pbiAqIHRpbWVDb25zdC5zZWM7XG4gICAgICAgIHN0YXJ0VGltZSA9IHN0YXJ0VGltZVNlYyArIHN0YXJ0VGltZU1pblx0KyBzdGFydFRpbWVIcjtcbiAgICAgICAgcmVzLnN0YXJ0VGltZSA9IHN0YXJ0VGltZTtcblxuICAgICAgICAvLyA9PT0gQ29udmVydCBlbmQgdGltZSB0byBNUyA9PT1cbiAgICAgICAgbGV0IGVuZFRpbWUgPSB0aW1lWzFdLnNwbGl0KCc6Jyk7XG4gICAgICAgIGxldCBlbmRUaW1lU2VjID0gcGFyc2VJbnQoZW5kVGltZVsyXS5zcGxpdCgnLCcpLmpvaW4oJycpKTtcbiAgICAgICAgbGV0IGVuZFRpbWVNaW4gPSBwYXJzZUludChlbmRUaW1lWzFdKSAqIHRpbWVDb25zdC5taW4gKiB0aW1lQ29uc3Quc2VjO1xuICAgICAgICBsZXQgZW5kVGltZUhyID0gcGFyc2VJbnQoZW5kVGltZVswXSkgKiB0aW1lQ29uc3QuaHIgKiB0aW1lQ29uc3QubWluICogdGltZUNvbnN0LnNlYztcbiAgICAgICAgZW5kVGltZSA9IGVuZFRpbWVTZWMgKyBlbmRUaW1lTWluXHQrIGVuZFRpbWVIcjtcbiAgICAgICAgcmVzLmVuZFRpbWUgPSBlbmRUaW1lO1xuXG4gICAgICAgIHJlcy50aW1lTGVuZ3RoID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcblxuICAgICAgICAvLyA9PT0gSm9pbiBzdWJ0aXRsZSBjb250ZW50ID09PVxuICAgICAgICBzdWJ0aXRsZS5zcGxpY2UoMCwgMik7XG4gICAgICAgIHJlcy5jb250ZW50ID0gc3VidGl0bGU7XG5cbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIHNob3dTdWIgKHN1Yikge1xuICAgIGlzU3VidGl0bGVTaG93biA9IHRydWU7XG5cbiAgICB2aWRlby5wYXVzZSgpO1xuICAgIGRyYXdTdWIoc3ViKTtcbn1cblxuZnVuY3Rpb24gZHJhd1N1YiAoc3ViKSB7XG4gICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7XG4gICAgY3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgY3R4LmZpbGxTdHlsZSA9ICd3aGl0ZSc7XG4gICAgY3R4LmZvbnQgPSBgMS41ZW0gT3JhbmllbmJhdW0sIHNlcmlmYDtcblxuICAgIGxldCB0ZXh0SGVpZ2h0ID0gKHN1Yi5jb250ZW50Lmxlbmd0aCAqIDI0KSArICgoc3ViLmNvbnRlbnQubGVuZ3RoIC0gMSkgKiAxMik7XG4gICAgbGV0IHRvcFBhZGRpbmcgPSAoY2FudmFzLmhlaWdodCAtIHRleHRIZWlnaHQpIC8gMjtcblxuICAgIHN1Yi5jb250ZW50LmZvckVhY2goKGVsLCBpKSA9PiB7XG4gICAgICAgIGxldCB0b3AgPSB0b3BQYWRkaW5nICsgKDI0ICogaSkgKyAoMTIgKiBpKTtcbiAgICAgICAgbGV0IGxlZnQgPSAoY2FudmFzLndpZHRoICogMC4xKTtcbiAgICAgICAgY3R4LmZpbGxUZXh0KGVsLCBsZWZ0LCB0b3ApO1xuICAgIH0pOyBcbn1cblxuZnVuY3Rpb24gaGlkZVN1YiAoKSB7XG4gICAgaWYgKGlzU3VidGl0bGVTaG93bikge1xuICAgICAgICBpc1N1YnRpdGxlU2hvd24gPSBmYWxzZTtcbiAgICAgICAgc3VidGl0bGVJbmRleCsrO1xuICAgICAgICB2aWRlby5wbGF5KCk7XG4gICAgfVxuICAgIGNsZWFyVGltZW91dChzdWJUaW1lb3V0KTtcbiAgICBzdWJUaW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgIGNvbnRyb2xFbGVtZW50cyA9IFtdO1xuICAgIGNyZWF0ZVBhdXNlRWxlbWVudCgpO1xufVxuXG5mdW5jdGlvbiBzdG9wU3ViVGltZW91dCAoKSB7XG4gICAgaWYoc3ViVGltZW91dCkge1xuICAgICAgICBjbGVhclRpbWVvdXQoc3ViVGltZW91dCk7XG4gICAgICAgIHN1YlRpbWVvdXQgPSB1bmRlZmluZWQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBzdGFydFN1YlRpbWVvdXQgKCkge1xuICAgIHN1YlRpbWVvdXQgPSBzZXRUaW1lb3V0KGhpZGVTdWIsIHN1YnRpdGxlc1tzdWJ0aXRsZUluZGV4XS50aW1lTGVuZ3RoKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
